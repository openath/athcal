<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>JSON Test</title>

        <!-- Font -->
        <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
        <!-- FontAwesome Icons -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css" integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc" crossorigin="anonymous">
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
        <!-- Bootstrap Multiselct -->
        <link rel="stylesheet" href="css/bootstrap-multiselect.min.css" type="text/css" />
        <link href="css/caldisplay_vue.css" rel="stylesheet">
        <style>
            body {
                height: 100%;
            }
            label {
                font-size: 1em;
            }
            #app {
                height: 100%;
                background-color: #F0F0F0;
            }
            .row-cols-7>* {
                -ms-flex: 0 0 14.285714285714285714285714285714%;
                flex: 0 0 14.285714285714285714285714285714%;
                max-width: 14.285714285714285714285714285714%;
            }
            .bg-orange {
                background-color: #F15A22;
                color: white;
            }
            .text-orange {
                color: #F15A22 !important;
            }
            
            /* SideBar Filtering */
            .sidebar-sticky {
                max-height: 700px;
                overflow: auto;
            }
            .filter-heading {
                font-size: 1.2em;
                -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;
            }
            @media (min-width: 576px) {
                #mobileHeader {
                    padding: 0 !important;
                    box-shadow: unset !important;
                    position: unset !important;
                    background-color: transparent !important;
                }
            }

            /* Multiselect */
            #mobileFilter .multiselect-native-select .btn-group {
                width: 49%;
                vertical-align: middle;
            }
            #sidebarMenu .multiselect-native-select .btn-group {
                width: 180px;
                vertical-align: middle;
            }
            .filter-button {
                color: white;
                font-weight: 500;
                text-decoration: none;
                /* margin: .5rem 1rem; */
                text-align: left;
                display: flex;
                justify-content: space-between;
                margin-left: 5px;
            }
            .filter-button .multiselect-selected-text {
                font-size: 0.8em;
                white-space: normal;
            }
            .dropdown-toggle::after {
                margin-top: 6px;
            }
            .btn-link {
                text-decoration: none;
            }
            .btn-link:hover {
                color: white;
                text-decoration: none;
            }
            .btn-link.focus, .btn-link:focus {
                text-decoration: none;
            }
            .checkbox {
                font-size: 0.8em;
            }
            .multiselect-item.multiselect-group > a {
                color: #F15A22;
                width: fit-content;
            }
            .multiselect-item.multiselect-group > a:hover {
                text-decoration: none;
            }
            .multiselect-container>li.multiselect-group label {
                padding: 3px 20px 3px 10px;
                display: inline;
            }
            .caret-container .caret {
                display: inline-block;
                margin-left: .255em;
                vertical-align: .255em;
                content: "";
                border-top: .3em solid;
                border-right: .3em solid transparent;
                border-bottom: 0;
                border-left: .3em solid transparent;
            }

            /* CUSTOM SCROLL */
            .multiselect-container.dropdown-menu::-webkit-scrollbar, body::-webkit-scrollbar {
                width: 6px;
                height:6px;
                background-color: #F5F5F5;
            }
            body::-webkit-scrollbar-thumb {
                border-radius: 10px;
                -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
                background-color:#F15A22;
            }
            .multiselect-container.dropdown-menu::-webkit-scrollbar-thumb {
                border-radius: 10px;
                -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
                background-color: #555;
            }
            .multiselect-container.dropdown-menu::-webkit-scrollbar-track, body::-webkit-scrollbar-track {
                -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
                border-radius: 10px;
                background-color: #F5F5F5;
            }
            .multiselect-container>li>a>label {
                font-size: 0.9em;
                font-weight: unset !important;
                padding: .25rem 1rem;
                display: block;
                -webkit-box-align: unset;
                -webkit-align-items: unset;
                -ms-flex-align: unset;
                align-items: unset;
                -webkit-box-pack: unset;
                -webkit-justify-content: unset;
                -ms-flex-pack: unset;
                justify-content: unset;
                margin-bottom: unset;
            }
            ul.nav.flex-column {
                position: fixed;
            }
            .multiselect-container > .active {
                color: #fff;
                text-decoration: none;
                background-color: #007bff;
            }
            .multiselect-item.multiselect-all {
                text-align: center;
                font-weight: 700;
            }
            .multiselect-item.multiselect-all input {
                visibility: hidden;
                display: none;
            }
            #m-series-choices + div > ul {
                min-width: 17rem;
            }
            #series-choices + div > ul {
                width: 260px;
                max-width: 260px;
                transform: translate3d(-1px, 33px, 0px)!important;
		    }
            #event-choices + div > ul {
                width: 200px;
                max-width: 200px;
                transform: translate3d(-1px, 33px, 0px)!important;
            }
            #m-event-choices + div > ul {
                width: 12rem;
                max-width: 12rem;
            }
            #m-age-group-choices + div > ul {
                width: 11rem;
                max-width: 11rem;
		    }
            #age-group-choices + div > ul {
                max-width: 12rem;
		    }
            #wa-category-choices + div > ul {
                max-width: 10.5rem;
		    }
            #m-wa-category-choices + div > ul {
			    min-width: 11rem;
            }
            #discipline-choices + div > ul {
                width: 200px;
                max-width: 200px;
                transform: translate3d(-1px, 33px, 0px)!important;
            }
            #m-discipline-choices + div > ul {
			    min-width: 11rem;
		    }
            .fa-chevron-up {
                font-size: 0.7em;
            }
            .form-check-label {
                font-size: 0.9em;
                white-space: normal;
                max-width: 300px;
            }
            .card-body {
                background-color: #da7652;
            }
            label[title="hidden"] {
                display: none !important;
            }           

            /* Year Filter */
            #selectedYear {
                -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;
            }
            #selectedYear>i {
                font-size: 0.8em;
            }
            #selectedYear>i:hover {
                color: #707070;
                cursor: pointer;
            }
            
            /* Month Filter */
            .month-heading {
                color: #707070;
                text-decoration: underline;
                -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;
            }
            .month-heading:hover {
                color: #F15A22;
                cursor: pointer;
            }
            /* Month Filter (table row) */
            .table-row-month {
                background-color: #F0F0F0;
            }

            /* LightBox Competition Details */
            .modal-header > h6 {
                font-size: 1rem;
            }
            @media (min-width: 576px) {
                .modal-dialog {
                    max-width: 800px;
                    margin: 1.75rem auto;
                }
            }
            .list-group-item h6 {
                font-size: 0.9rem; 
            }
            #eventTable {
                width: 200px;
            }
            #eventTable td , #eventTable th {
                padding: 0.25rem;
            }

            /* Table */
            .bg-primary {
                background-color: #00053E !important;
            }
            #competitionTable tbody tr td:first-child {
                width:90px
            }
            .table-responsive {
                padding-top: 0px;
            }
            @media (max-width: 576px) {
                body {
                    overflow-y: hidden;
                }
                .table-responsive {
                    padding-top: 200px;
                }
                #main-content {
                    overflow-y: auto;
                    height: 750px;
                }
            }
            /* Custom width */
            @media (min-width: 768px) {
                .col-md-2-5 {
                    -ms-flex: 0 0 20.8333333%;
                    flex: 0 0 20.8333333%;
                    max-width: 20.8333333%;
                }
                .col-md-9-5 {
                    -ms-flex: 0 0 79.1666667%;
                    flex: 0 0 79.1666667%;
                    max-width: 79.1666667%;
                }
            }

            /* Pagination / reset filters */
            @media (max-width: 576px) {
                #paginatorContainer {
                    flex-direction: column;
                    align-items: unset!important;
                }
            }

            /* Pagination */
            .page-item {
                cursor: pointer;
            }
            .page-link {
                -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;
            }
            /* The animation code */
            @keyframes chevron-flip {
                0% {transform: rotate(0deg);}
                100% {transform: rotate(180deg);}
            }
            .chevron-animate-up {
                animation-name: chevron-flip;
                animation-iteration-count: 1;
                animation-duration: 0.4s;
                animation-fill-mode: forwards;
                animation-direction: normal;
            }
            .chevron-animate-down {
                animation-name: chevron-flip;
                animation-iteration-count: 1;
                animation-duration: 0.4s;
                animation-fill-mode: forwards;
                animation-direction: reverse;
            }
            .bd-placeholder-img {
                font-size: 1.125rem;
                text-anchor: middle;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
            @media (min-width: 768px) {
                .bd-placeholder-img-lg {
                    font-size: 3.5rem;
                }
            }
            @media (min-width: 992px) {
                .row-cols-lg-7>* {
                    -ms-flex: 0 0 14.285714285714285714285714285714%;
                    flex: 0 0 14.285714285714285714285714285714%;
                    max-width: 14.285714285714285714285714285714%;
                }
            }
        </style>
        <!-- Custom styles for this template -->
    </head>
    <body>
        <div id="app">
            <div class="container-fluid">
                <div class="row">
                    <nav id="sidebarMenu" class="col-md-2-5 col-lg-2 d-md-block sidebar collapse bg-orange">
                        <div class="sidebar-sticky pt-3">
                            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                                <span class="text-white">Filter</span>
                                <!-- <a class="d-flex align-items-center text-muted" href="#" aria-label="Add a new report">
                                    <span data-feather="plus-circle"></span>
                                </a> -->
                            </h6>
                            
                            <div class="form-group">
                                <input class="form-control" v-model="name_search_query" type="text" placeholder="Search name">
                            </div>
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <select name="location" id="location-choices"  multiple="multiple"></select>
                                </li>
                                <li class="nav-item">
                                    <select name="wa-category" id="wa-category-choices"  multiple="multiple"></select>
                                </li>
                                <li class="nav-item">
                                    <select name="Series" id="series-choices"  multiple="multiple"></select>
                                </li>
                                <li class="nav-item">
                                    <select name="discipline" id="discipline-choices"  multiple="multiple"></select>
                                </li>
                                <li class="nav-item">
                                    <select name="age-groups" id="age-group-choices"  multiple="multiple"></select>
                                </li>
                                <li class="nav-item">
                                    <select name="events" id="event-choices"  multiple="multiple"></select>
                                </li>
                            </ul>
                        </div>
                    </nav>

                    

                    <main role="main" class="col-md-9-5 ml-sm-auto col-lg-10 px-0 px-md-4">
                        
                        <div id="mobileHeader" class="bg-white fixed-top shadow p-3">
                            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center ">
                                <div id="selectedYearContainer" class="mx-auto">
                                    <h1 id="selectedYear" class="d-inline text-orange">
                                        <i class="fas fa-angle-left mx-2" @click="decrementYear()"></i>
                                        {{ selectedYear }}
                                        <i class="fas fa-angle-right mx-2" @click="incrementYear()"></i>
                                    </h1>
                                </div>
                                <!-- <div class="btn-toolbar mb-2 mb-md-0 d-none d-md-block" style="position: absolute;right:20px;">
                                    <div class="btn-group mr-2">
                                        <button type="button" class="btn btn-sm btn-outline-secondary" data-toggle="collapse" data-target="#eventDays" aria-expanded="false" aria-controls="eventDays">Calendar View</button>
                                        <button type="button" class="btn btn-sm btn-outline-secondary">Map View</button>
                                    </div>
                                </div> -->
                            </div>
    
                            <!-- Toggles show/hide of filters -->
                            <a class="btn btn-primary btn-sm d-md-none mb-1" data-toggle="collapse" href="#mobileFilter" role="button" aria-expanded="false" aria-controls="mobileFilter">
                                <i class="fas fa-filter"></i>
                            </a>
    
                            <!-- Data is injected into multiselct through 'initialiseMultiSelect' -->
                            <div id="mobileFilter" class="collapse">
                                <select name="location" id="m-location-choices" multiple="multiple"></select>
                                <select name="wa-category" id="m-wa-category-choices" multiple="multiple"></select>
                                <select name="series" id="m-series-choices" multiple="multiple"></select>
                                <select name="discipline" id="m-discipline-choices" multiple="multiple"></select>
                                <select name="age_group" id="m-age-group-choices" multiple="multiple"></select>
                                <select name="events" id="m-event-choices" multiple="multiple"></select>
                            </div>
    
    
                            <!-- Shows each month -->
                            <div id="months-headings" class="d-none d-md-flex row pt-3 pb-2 mb-3 border-bottom">
                                <div class="col-md-1 d-md-inline" v-for="month in months_data" >
                                    <h5 class="month-heading d-block mb-0 text-center" v-on:click="applyDateFilter(month)">{{ month.name }}</h5>
                                    <div class="d-block mx-auto" style="width:fit-content">
                                        <span class="badge badge-pill badge-secondary">{{ month.numberOfComps }}</span>
                                    </div>
                                </div>
                            </div>
    
                            <!-- Shows each day of each month -->
                            <div id="eventDays" class="row row-cols-7 collapse">
                                <div class="col p-3" v-for="n in 42">
                                    <div class="border border-dark">
                                        <h3>{{ n }}</h3>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="paginatorContainer" class="d-flex flex-horizontal justify-content-between align-items-center">
                                <div class="d-flex d-md-inline">
                                    <span v-if="filteredCompetitions" class="badge badge-secondary mb-0">{{ filteredCompetitions.length || 0 }} of {{ info && info.length || 0 }} competitions</span>
                                    <a class="d-block d-md-inline ml-1" href="javascript:location.reload(true)">Reset filters</a>
                                </div>
                                <navigator class="float-right" :is-loading="isLoading" :total="filteredCompetitions && filteredCompetitions.length || 0" @movePage="mvPg" @changePage="setPg" :results-per-page="showOnPage"></navigator>
                            </div>
                        </div>

                        <div id="main-content" class="px-2">
                            <div class="table-responsive">
                                <table id="competitionTable" class="table table-sm list bg-white">
                                    <thead class="bg-primary text-white">
                                        <tr>
                                            <th scope="col" class="d-lg-table-cell">Date</th>
                                            <th scope="col"><span class="d-none d-sm-block">Full Name</span><span class="d-block d-sm-none">Name</span></th>
                                            <th class="d-none d-lg-table-cell text-center" scope="col"><span class="d-none d-sm-block">Age Groups</span><span class="d-block d-sm-none">Age</span></th>
                                            <th class="d-none d-lg-table-cell text-center" scope="col">WA Cat</th>
                                            <th class="text-center" scope="col"><span class="d-none d-sm-block">Country</span><span class="d-block d-sm-none">Cnty</span></th>
                                            <th class="text-center" scope="col"><span class="d-none d-sm-block">Discipline</span><span class="d-block d-sm-none">Type</span></th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr v-if="paginatedCompetitions().length == 0">
                                            <td></td>
                                            <td>No competitions</td>
                                        </tr>
                                        <tr v-for="comp in paginatedCompetitions()"  :key="comp.id">
                                            <td>{{comp.date}}</td>
                                            <td v-if="comp.english_name != ''"><a href="" @click="showCompetitionDetails(comp)" data-toggle="modal" data-target="#competitionDetailModel">{{ comp.english_name }}</a></td>
                                            <td v-else><a href="" @click="showCompetitionDetails(comp)" data-toggle="modal" data-target="#competitionDetailModel">{{ comp.full_name }}</a></td>

                                            <td class="d-none d-lg-table-cell text-center">{{ comp.age_groups }}</td>
                                            <td class="d-none d-lg-table-cell text-center">{{ getCategoryCode(comp.wa_rankings_category) }}</td>
                                            
                                            <td class="text-center">{{ comp.country_ioc }}</td>
                                            <td class="text-center">{{ comp.type }}</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                            <nav class="d-flex justify-content-center">
                                <navigator class="float-right" :is-loading="isLoading" :total="filteredCompetitions && filteredCompetitions.length || 0" @movePage="mvPg" @changePage="setPg" :results-per-page="showOnPage"></navigator>
                            </nav>
                        </div>
                    </main>
                </div>
            </div>
        
            <!-- Competition Modal/Lightbox -->
            <div class="modal fade" id="competitionDetailModel" tabindex="-1" aria-labelledby="competitionDetailModel" aria-hidden="true">
                <div class="modal-dialog modal-xl modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="competitionDetailName">{{ selectedCompetition.english_name }}<h6 v-if="selectedCompetition.name_local != ''" class="blockquote-footer my-auto mx-2">{{ selectedCompetition.name_local }}</h6></h5>
                            <h5 v-if="selectedCompetition.english_name == ''" class="modal-title" id="competitionDetailName">{{ selectedCompetition.full_name }}<h6 v-if="selectedCompetition.name_local != ''" class="blockquote-footer my-auto mx-2">{{ selectedCompetition.name_local }}</h6></h5>
                            
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col">
                                    <p v-if="selectedCompetition.english_name != ''">{{ selectedCompetition.full_name }}</p>
                                    <p>{{ selectedCompetition.basic_description }}</p>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <ul class="list-group">
                                        <li class="list-group-item d-flex align-items-center"><h6 class="mr-auto my-0">Contact Name</h6>
                                            <span v-if="selectedCompetition.contact_name !=''" class="badge badge-primary badge-pill">{{ selectedCompetition.contact_name }}</span>
                                            <span v-else >None</span>
                                        </li>
                                        <li class="list-group-item d-flex align-items-center"><h6 class="mr-auto my-0">Contact Details</h6>
                                            <span v-if="selectedCompetition.contact_details !=''" class="badge badge-primary badge-pill">{{ selectedCompetition.contact_details }}</span>
                                            <span v-else >None</span>
                                        </li>
                                        <li class="list-group-item d-flex align-items-center"><h6 class="mr-auto my-0">Dates</h6> 
                                            <a>
                                                From <span class="badge badge-success badge-pill">{{ selectedCompetition.date }}</span> 
                                                To <span class="badge badge-danger badge-pill">{{ selectedCompetition.finish_date }}</span>
                                            </a>
                                        </li>
                                        <li class="list-group-item d-flex align-items-center">
                                            <h6 class="mr-auto my-0">Events detail</h6> 
                                            <table id="eventTable" class="table table-borderless">
                                                <thead>
                                                    <tr>
                                                      <th scope="col">Code</th>
                                                      <th scope="col">Genders</th>
                                                      <th scope="col">Age</th>
                                                    </tr>
                                                  </thead>
                                                <body>
                                                    <tr v-for="e in selectedCompetition.events"><td>{{ e.event_code }}</td><td>{{ e.genders }}</td><td>{{ e.age_groups }}</td></tr>
                                                </body>
                                            </table>
                                        </li>
                                        <li class="list-group-item d-flex align-items-center">
                                            <h6 class="mr-auto my-0">Competitors</h6>
                                            <a v-if="selectedCompetition.ot_supported && selectedCompetition.num_competitors > 0" :href="`${opentrackURL}/x/${selectedCompetition.year}/${selectedCompetition.country_ioc}/${selectedCompetition.slug}/competitor/`" class="px-3" target="_blank" rel="noopener noreferrer">Click here</a>
                                            <span class="badge badge-primary badge-pill">{{ selectedCompetition.num_competitors }}</span>
                                        </li>
                                        <li class="list-group-item d-flex align-items-center">
                                            <h6 class="mr-auto my-0">Results</h6>
                                            <a v-if="selectedCompetition.ot_supported && selectedCompetition.results_link" :href="selectedCompetition.results_link" class="px-3" target="_blank" rel="noopener noreferrer">Click here</a>
                                            <span class="badge badge-primary badge-pill">{{ selectedCompetition.num_results }}</span>
                                        </li>
                                        <li v-if="selectedCompetition.website != ''" class="list-group-item d-flex align-items-center">
                                            <h6 class="mr-auto my-0">Website</h6>
                                            <a :href="selectedCompetition.website" class="px-3" target="_blank" rel="noopener noreferrer">Click here</a>
                                            <span class="badge badge-primary badge-pill invisible">44</span>
                                        </li>
                                        <li v-if="selectedCompetition.ot_supported && selectedCompetition.num_competitors == 0 && !selectedCompetition.results_link" class="list-group-item d-flex align-items-center">
                                            <h6 class="mr-auto my-0">OpenTrack</h6>
                                            <a :href="`${opentrackURL}/x/${selectedCompetition.year}/${selectedCompetition.country_ioc}/${selectedCompetition.slug}/`" class="px-3" target="_blank" rel="noopener noreferrer">Click here</a>
                                            <span class="badge badge-primary badge-pill invisible">44</span>
                                        </li>
                                      </ul>
                                </div>
                                <div class="col">
                                    <div id="map" class="w-100" style="height:300px"></div>
                                </div>
                            </div>
                            
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error Modal - displays error when fetching data -->
            <div class="modal fade show" id="errorModel" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="errorModel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="errorModelTitle">"Error title"</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body" id="errorModelDescription">
                            "error message"
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Navigator -->
        <script type="text/template" id="navigator_template">
            <ul class="pagination mr-0 my-1" v-if="isLoading || total > resultsPerPage" v-cloak>
                <li :class="{'page-item': true, disabled: $parent.page == 0}">
                    <a class="page-link" @click="prevPage" aria-label="Previous">
                        <span aria-hidden="true" class="d-none d-lg-inline-block hidden-xs hidden-sm hidden-md">Prev</span>
                        <span class="d-inline-block d-lg-none hidden-lg">&laquo;</span>
                    </a>
                </li>
                <!--  partial -->
                <li v-if="numPages > threshold && $parent.page > 2" :class="{'page-item': true, active: $parent.page == 1}"><a class="page-link" @click="setPage(1)">1</a></li>
                <li v-if="numPages > threshold && $parent.page > 3" class="page-item disabled"><span class="page-link">...</span></li>
                <li v-if="numPages > threshold" v-for="pi in _.range(Math.max(1, $parent.page - 1), Math.min(numPages, $parent.page + 2) + 1)"
                    :class="{'page-item': true, active: $parent.page == pi}">
                    <a @click="setPage(pi)" class="page-link">{{ pi }}</a>
                </li>
                <li v-if="numPages > threshold && $parent.page < numPages - 3" class="page-item disabled"><span class="page-link">...</span></li>
                <li v-if="numPages > threshold && $parent.page < numPages - 2" class="page-item"><a class="page-link" @click="setPage(numPages)">{{ numPages }}</a></li>
                <li v-else-if="numPages <= threshold" v-for="i in _.range(1, numPages+1)" :class="{'page-item': true, active: $parent.page == i}">
                    <a @click="setPage(i)" class="page-link">{{ i }}</a>
                </li>
                <li :class="{'page-item': true, disabled: $parent.page == numPages}">
                    <a class="page-link" @click="nextPage" aria-label="Next">
                        <span aria-hidden="true" class="d-none d-lg-inline-block hidden-xs hidden-sm hidden-md">
                            <span v-if="isLoading"><img src="./img/ajax-loading.gif" alt="Loading" /> Loading ...</span>
                            <span v-else>Next</span>
                        </span>
                        <span class="d-inline-block d-lg-none hidden-lg">
                            <span v-if="isLoading"><img src="./img/ajax-loading.gif" alt="Loading" /> Loading ...</span>
                            <span v-else>&raquo;</span>
                        </span>
                    </a>
                </li>
            </ul>
        </script>
        <!-- Bootstrap JS, Popper.js, and jQuery -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
        
        <!-- Bootstrap Multiselct JS -->
        <script type="text/javascript" src="./js/bootstrap-multiselect.js"></script>
        
        <!-- Google Maps API -->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNwYdWaTG9yfjZydsHKW3tnm-rn8f30sw&libraries=places"></script>
        <!-- Vue -->
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <!-- Axios -->
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <!-- Lodash -->
        <script src="./js/lodash.js"></script>
        <!-- Paginator JS -->
        <script src="./js/navigator-script.js"></script>
        <script>
            $(document).ready(() => {
                // Handles toggling of show/hide animations for filter options
                // Toggles the collapse of filters
                $(".filter-heading.d-block.text-white").click(function(){
                    $(this).next().collapse('toggle');
                });
                $('.collapse').on('show.bs.collapse', function() {
                    var chevron = $(this).prev().children('i');
                    chevron.addClass('chevron-animate-up');
                    setTimeout(() => {
                        chevron.removeClass('chevron-animate-down');
                        var rotate = chevron.css('transform');
                        chevron.css('transform', rotate);
                        chevron.removeClass('chevron-animate-up');
                    }, 500);
                });
                $('.collapse').on('hide.bs.collapse', function() {
                    var chevron = $(this).prev().children('i');
                    chevron.addClass('chevron-animate-down');
                    setTimeout(() => {
                        chevron.removeClass('chevron-animate-up');
                        var rotate = chevron.css('transform');
                        chevron.css('transform', rotate);
                        chevron.removeClass('chevron-animate-down');
                    }, 500);
                });

                // Hide certain dropdown options
                setTimeout(() => {
                    $('input[value="dropdown"]').parent().parent().parent().css('display', "none")
                    $('label[title="hidden"]').parent().parent().attr('style', 'display: none !important');
                }, 1000);
            });

            var app = new Vue({
                el: '#app',
                props: {
                    waCategories: {
                        type: Array,
                        default: function() {
                            return [{label:'Olympic Games & World Championships', code:'OW', value:"1"}, {label:'Diamond League Finals', code:'DF', value:"2"}, {label:'World specialist championships (e.g. indoor), DLs', code:'GW', value:"3"}, {label:'Platinum and Gold Label', code:'GL', value:"4"}, {label:'Major Games, WACT Gold', code:'A', value:"5"}, {label:'WACT Silver, ETCH, National Champs', code:'B', value:"6"}, {label:'WA U20, WACT Bronze, Area 3rd Tier', code:'C', value:"7"}, {label:'Traditional International, National Senior Indoor', code:'D', value:"8"}, {label:"Int'l Matches, Selected National Meetings", code:'E', value:"9"}, {label:'International Meetings with National Permit', code:'F', value:"10"}, {label:'Unclassified but of international interest', code:'Unclassified', value:"11"}];
                        } 
                    },
                    compSeries: {	
                        type: Array,	
                        default: function() {	
                            return [{label: '', value: 'dropdown', children: [{label:'WA Major Events', value:'6', title: 'WA Major Events'}, {label:'Diamond League', value:'10', title: 'Diamond League'}]}, {label:'WA Outdoor Tour', children: [{label:'WA Outdoor Tour Gold', value:'1', title: 'WACT Europe Gold Meetings (Indoors)'}, {label:'WA Outdoor Tour Silver', value:'2', title: 'WACT Europe Silver Meetings (Indoors)'}, {label:'WA Outdoor Tour Bronze', value:'3', title: 'WACT Europe Bronze Meetings (Indoors)'}]}, {label:'WA Indoor Tour', children: [{label:'hidden', value:'12', title: 'hidden', hidden: true}, {label:'WA Indoor Tour Gold', value:'77', title: 'WACT Europe Gold Meetings'}, {label:'WA Indoor Tour Silver', value:'78', title: 'WACT Europe Silver Meetings'}, {label:'WA Indoor Tour Bronze', value:'79', title: 'WACT Europe Bronze Meetings'}]}, {label: '', value: 'dropdown', children: [{label:'WA Continental Tour', value:'11', title: 'World Athletics Continental Tour'}, {label:'EA Major Events', value:'5', title: 'European Athletics Major Events'}, {label:'WA Permits', value:'9', title: 'WA Permits'}, {label:'EA Permits', value:'15', title: 'EA Permits'}, {label:'National Championships', value:'4', title: 'National Championships'}, {label:'National Permits', value:'73', title: 'National Permits'}, {label:'International Matches', value:'7', title: 'International Matches'}, {label:'Other international events', value:'14', title: 'Other international events'}, {label:'Other national events', value:'13', title: 'Other national events'}]}];
                        }	
                    },
                    ageGroups: {
                        type: Array,
                        default: function () {
                            return [{label:'Seniors', value:'SEN'}, {label:'Masters', value:'M'}, {label:'U23', value:'U23'}, {label:'U20', value:'U20'}, {label:'U18', value:'U18'}]
                        }
                    },
                    compTypes: {
                        type: Array,
                        default: function () {
                            return [{label:'Track', value:'TRACK'}, {label:'Indoor', value:'INDOOR'}, {label:'Road races', value:'ROAD'}, {label:'Cross country', value:'XC'}, {label:'Mountain running', value:'MOUNTAIN'}, {label:'Race walking', value:'WALK'}]
                        }
                    },
                    events: {
                        type: Array,
                        default: function () {
                            return [{label: '60m', value: '60', title: '60 Metres'}, {label: '100m', value: '100', title: '100 Metres'}, {label: '200m', value: '200', title: '200 Metres'}, {label: '400m', value: '400', title: '400 Metres'}, {label: '800m', value: '800', title: '800 Metres'}, {label: '1500m', value: '1500', title: '1500 Metres'}, {label: '3000m', value: '3000', title: '3000 Metres'}, {label: '5000m', value: '5000', title: '5000 Metres'}, {label: '10,000m', value: '10000', title: '10,000 Metres'}, {label: 'Half-Marathon', value: 'HM', title: 'Half Marathon (21.0975km)'}, {label: 'Marathon', value: 'MAR', title: 'Marathon (42.195km)'}, {label: '2000m Steeplechase', value: '2000SC', title: '2000 Metres Steeplechase'}, {label: '3000m Steeplechase', value: '3000SC', title: '3000 Metres Steeplechase'}, {label: '60mH', value: '60H', title: '60 Metres Hurdles'}, {label: '100mH', value: '100H', title: '100 Metres Hurdles'}, {label: '110mH', value: '110H', title: '110 Metres Hurdles'}, {label: '400mH', value: '400H', title: '400 Metres Hurdles'}, {label: 'High Jump', value: 'HJ'}, {label: 'Pole Vault', value: 'PV'}, {label: 'Long Jump', value: 'LJ'}, {label: 'Triple Jump', value: 'TJ'}, {label: 'Shot Put', value: 'SP'}, {label: 'Discus', value: 'DT'}, {label: 'Hammer', value: 'HT'}, {label: 'Javelin', value: 'JT'}, {label: '20km Walk', value: '20KW'}, {label: '4X100m Relay', value: '4X100'}, {label: 'Pentathlon', value: 'PEN'}, {label: 'Heptathlon', value: 'HEP'},  {label: 'Decathlon', value: 'DEC'}]
                        }
                    },
                    trackEvents: {
                        type: Array,
                        default: function () {
                            return [{label: '60m', value: '60', title: '60 Metres'}, {label: '100m', value: '100', title: '100 Metres'}, {label: '200m', value: '200', title: '200 Metres'}, {label: '400m', value: '400', title: '400 Metres'}, {label: '800m', value: '800', title: '800 Metres'}, {label: '1500m', value: '1500', title: '1500 Metres'}, {label: '3000m', value: '3000', title: '3000 Metres'}, {label: '5000m', value: '5000', title: '5000 Metres'}, {label: '10,000m', value: '10000', title: '10,000 Metres'}, {label: '60mH', value: '60H', title: '60 Metres Hurdles'}, {label: '100mH', value: '100H', title: '100 Metres Hurdles'}, {label: '110mH', value: '110H', title: '110 Metres Hurdles'}, {label: '400mH', value: '400H', title: '400 Metres Hurdles'}, {label: '2000m Steeplechase', value: '2000SC', title: '2000 Metres Steeplechase'}, {label: '3000m Steeplechase', value: '3000SC', title: '3000 Metres Steeplechase'}, {label: '4X100m Relay', value: '4X100'}]
                        }
                    },
                    fieldEvents: {
                        type: Array,
                        default: function () {
                            return [{label: 'High Jump', value: 'HJ'}, {label: 'Pole Vault', value: 'PV'}, {label: 'Long Jump', value: 'LJ'}, {label: 'Triple Jump', value: 'TJ'}, {label: 'Shot Put', value: 'SP'}, {label: 'Discus', value: 'DT'}, {label: 'Hammer', value: 'HT'}, {label: 'Javelin', value: 'JT'}]
                        }
                    },
                    roadEvents: {
                        type: Array,
                        default: function () {
                            return [{label: '20km Walk', value: '20KW'}, {label: 'Half-Marathon', value: 'HM', title: 'Half Marathon (21.0975km)'}, {label: 'Marathon', value: 'MAR', title: 'Marathon (42.195km)'}]
                        }
                    },
                    combinedEvents: {
                        type: Array,
                        default: function () {
                            return [{label: 'Pentathlon', value: 'PEN'}, {label: 'Heptathlon', value: 'HEP'},  {label: 'Decathlon', value: 'DEC'}]
                        }
                    },
                    allMonths: {
                        type: Array,
                        default: function () {
                            return [{name: 'JAN', num: 1, numberOfComps: 0, string: "01"}, {name: 'FEB', num: 2, numberOfComps: 0, string: "02"}, {name: 'MAR', num: 3, numberOfComps: 0, string: "03"}, {name: 'APR', num: 4, numberOfComps: 0, string: "04"}, {name: 'MAY', num: 5, numberOfComps: 0, string: "05"}, {name: 'JUN', num: 6, numberOfComps: 0, string: "06"}, {name: 'JUL', num: 7, numberOfComps: 0, string: "07"}, {name: 'AUG', num: 8, numberOfComps: 0, string: "08"}, {name: 'SEP', num: 9, numberOfComps: 0, string: "09"}, {name: 'OCT', num: 10, numberOfComps: 0, string: "10"}, {name: 'NOV', num: 11, numberOfComps: 0, string: "11"}, {name: 'DEC', num: 12, numberOfComps: 0, string: "12"}]
                        }
                    },
                    pageSize: {
                        type: Number,
                        default: function () { return 50 }
                    },
                    opentrackURL: {
                        type: String,
                        default: function () { return 'https://data.opentrack.run'}
                    }
                },
                data() {
                    var self=this;
                    return {
                        info: [],
                        name_search_query: '',
                        all_months: [],
                        series_options: [],
                        country_options: [],
                        selectedYear: new Date().getFullYear(),
                        selectedMonths: [],
                        selectedCompType: [],
                        selectedAG: [],
                        selectedCountries: [],
                        selectedWACategories: [],
                        selectedSeries: [],
                        selectedCompetition: {},
                        selectedEvents: [],

                        map: {},
                        mapFinder: {},
                        

                        showOnPage: 16,
                        page: 1,
                        isLoading: true,
                        hasInitialised: false,
                    }
                },
                computed: {
                    filteredCompetitions: function () {
                        var self = this,
                            output = self.info || [];

                        if (self.name_search_query != '') {
                            output = output.filter(function (item) {
                                if (item.english_name != "") {
                                    return item.english_name.toLowerCase().includes(self.name_search_query.toLowerCase())
                                } else {
                                    return item.full_name.toLowerCase().includes(self.name_search_query.toLowerCase())
                                }
                            })
                        }
                        if (self.selectedCountries.length > 0) {
                            output = output.filter(function (item) {
                                return self.selectedCountries.indexOf(item.country_ioc) >= 0
                            })
                        }
                        if (self.selectedCompType.length > 0) {
                            output = output.filter(function (item) {
                                return self.selectedCompType.indexOf(item.type) >= 0
                            })
                        }
                        if (self.selectedAG.length > 0) {
                            output = output.filter(function (item) {
                                var ageGroups = item.age_groups.split(',').map(function(ag) { return ag.trim() });
                                var hits = ageGroups.map(function (ag) {
                                    return self.selectedAG.indexOf(ag) >= 0
                                })
                                return hits.reduce(function (x, y) { return x || y }, false)
                            })
                        }
                        if (self.selectedYear) {
                            output = self.filterByDate(null, null, output)
                        }
                        if (self.selectedMonths.length > 0) {
                            var list = [];
                            self.selectedMonths.forEach(month => list = list.concat(self.filterByDate(month.string, null, output)));
                            output = list;
                        }
                        if (self.selectedWACategories.length > 0) {
                            output = output.filter(function (item) {
                                return self.selectedWACategories.indexOf(item.wa_rankings_category.toString()) >= 0
                            })
                        }
                        if (self.selectedEvents.length > 0) {
                            output = output.filter(function (item) {
                                return item.events ? item.events.some(e=> self.selectedEvents.indexOf(e.event_code) >= 0) : false
                            })
                        }
                        if (self.selectedSeries.length > 0) {
                            output = output.filter(function (item) {
                                return item.series ? item.series.some(e=> self.selectedSeries.indexOf(e.series_id.toString()) >= 0) : false
                            })
                        }
                        return output
                    },
                    months_data: function() {
                        var self = this;
                        self.all_months = [];
                        if (self.info) {
                            for (month of self.allMonths) {
                                var compList = self.filterByDate(month.string);
                                month.numberOfComps = compList.length;
                                self.all_months.push(month);
                            }
                        }
                        var output = self.all_months;
                        return output;
                    }
                },
                methods:{
                    incrementYear: function() {
                        var self = this;
                        self.selectedYear++;
                        self.fetchData();
                    },
                    decrementYear: function() {
                        var self = this;
                        self.selectedYear--;
                        self.fetchData();
                    },
                    resetFilters: function() {
                        var self = this;
                        self.selectedMonths = [];
                        self.selectedCompType = [];
                        self.selectedAG = [];
                        self.selectedCountries = [];
                        self.selectedWACategories = [];
                        self.selectedSeries = [];
                        self.selectedCompetition = {};
                        self.selectedEvents = [];

                        self.displaySelectedMonths();
                        self.clearMonthsInTable();
                    },
                    applyDateFilter: function(month) {
                        var self = this;

                        // Resets page when first applying month filter
                        if (self.selectedMonths.length == 0) {
                            self.setPg(1);
                        }

                        // Check if month is contained in list
                        if (self.selectedMonths.some(e => e.name === month.name)) {
                            // Remove it
                            var selMonths = self.selectedMonths;
                            self.selectedMonths = selMonths.filter((mon) => mon.num != month.num);
                            self.removeMonthInTable(month);
                        } else {
                            // Add it
                            self.selectedMonths.push(month);
                            // sort list
                            self.sortSelectedMonths();
                            self.insertMonthInTable();
                        }
                        self.displaySelectedMonths();

                        
                    },
                    sortSelectedMonths: function() {
                        var self = this;
                        var months = self.selectedMonths;
                        self.selectedMonths = _.sortBy(months, function(item){
                            return self.allMonths.indexOf(item.name)
                        });
                    },
                    displaySelectedMonths: function() {
                        var self = this;
                        // Diplays which month is currently being filtered by
                        var calMonths = document.getElementById('months-headings');
                        Array.from(calMonths.children).forEach(mon => mon.children[0].classList.remove("text-orange"));

                        self.selectedMonths.forEach((month) => {
                            var clickedMonth = calMonths.children[month.num-1];
                            clickedMonth.children[0].classList.add("text-orange");
                        });
                    },

                    insertMonthInTable: function() {
                        var self = this;
                        var competitions = self.paginatedCompetitions();
                        // console.log("Insert");
                        // console.log(competitions);

                        // var month = self.selectedMonths.slice(-1)[0];
                        var totalNumberOfcomps = 0;
                        var rowPosition = 0;
                        var addedMonths = [];

                        // Clear table of months first
                        self.clearMonthsInTable();
                        for (const month of self.selectedMonths) {
                            var html =  `<tr class="table-row-month"><th scope="row" colspan="6">${month.name}</th></tr>`;
                            var monthIndex = self.selectedMonths.indexOf(month);

                            // Inserts months selected after first
                                // console.log(competitions.length, month.numberOfComps);
                                // insertRowLocation = (preMonthCompLength);
                            if (monthIndex > 0) {
                                rowPosition = totalNumberOfcomps+(monthIndex-1);
                            }
                            // console.log(totalNumberOfcomps);
                            for (const comp in competitions) {
                                var number = parseInt(comp)+1;
                                // console.log(addedMonths.indexOf(month) == -1);
                                // console.log(competitions[comp].date.match(`${self.selectedYear}-${month.string}`));

                                if (addedMonths.indexOf(month) == -1 && competitions[comp].date.match(`${self.selectedYear}-${month.string}`)) {
                                    // console.log("inserting row");
                                    // console.log(rowPosition);
                                    if (addedMonths.length != 0) {
                                        $('#competitionTable > tbody > tr').eq(rowPosition).after(html);
                                    } else {
                                        $('#competitionTable > tbody > tr').eq(0).before(html);
                                    }
                                    addedMonths.push(month);               
                                }
                            }
                            totalNumberOfcomps += self.filterByDate(month.string, null, competitions).length;
                        
                        }
                    },
                    clearMonthsInTable: function() {
                        var self = this;
                        $('#competitionTable > tbody').children('tr').each((i, element) => {
                            for (const month of self.selectedMonths) {
                                if ($(element).text() == month.name) {
                                    $(element).remove();
                                }
                            }
                        });
                    },
                    removeMonthInTable: function(month) {
                        var self = this;
                        $('#competitionTable > tbody').children('tr').each((i, element) => {
                            if ($(element).text() == month.name) {
                                $(element).remove();
                            }
                        });
                        self.insertMonthInTable();
                    },

                    filterByDate: function(month, day=null, data=this.info) {
                        var output = data,
                            self=this;
                        if (month && !day) {
                            var result = output.filter((item)=>{
                                return item.date.match(`${self.selectedYear}-${month}`);
                            })
                            return result;
                        } 
                        else if (month && day) {
                            var result = output.filter((item)=>{
                                return item.date.match(`${self.selectedYear}-${month}-${day}`);
                            })
                            return result;
                        }
                        else {
                            return output.filter((item)=>{
                                return item.date.match(`${self.selectedYear}`);
                            })
                        }
                    },
                    getCategoryCode: function(number) {
                        var self = this;
                        var output = self.waCategories.find(item => item.value == number)
                        return output.code;
                    },

                    // Show competition detail when clicked on competition
                    showCompetitionDetails: function(comp) {
                        var self = this;
                        self.selectedCompetition=comp;
                        console.log(comp);
                        // console.log(self.map);
                        if (self.selectedCompetition.address != "") {
                            $('#map').show();
                            self.updateMap(self.selectedCompetition.address);
                        } else {
                            $('#map').hide();
                        }
                    },

                    // Google maps methods
                    initMap: function() {
                        var self = this;
                        self.map = new google.maps.Map(document.getElementById("map"), {
                            center: null,
                            zoom: 8,
                        });
                        self.mapFinder = new google.maps.places.PlacesService(self.map);
                    },
                    updateMap: function(address) {
                        var self = this;
                        self.findPlace(address);
                    },
                    findPlace: function(address) {
                        var self = this;
                        const request = {
                            query: address,
                            fields: ["name", "geometry"],
                        };
                        self.mapFinder.findPlaceFromQuery(request, (results, status) => {
                            if (status === google.maps.places.PlacesServiceStatus.OK) {
                                self.map.setCenter(results[0].geometry.location);
                                self.createMarker(results[0]);
                            }else {
                                console.log("Google Maps: Could not get location");
                            }
                        });
                    },
                    createMarker: function(place) {
                        var self = this, map = self.map;
                        const marker = new google.maps.Marker({
                            map,
                            position: place.geometry.location,
                        });
                    },

                    // Initialisation of multiselect filtering buttons
                    initialiseMultiSelect: function() {
                        var self = this;
                        // Multiselect Buttons

                        function btnText(options, select, text) {
                            if (options.length == 1) {
                                if (options.html() != "") {
                                    return options.html();
                                } else {
                                    return options[0].label;
                                }
                            }
                            else {
                                return `${text} (${options.length})`;
                            }
                        }

                        var locationMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2',
                            maxHeight: 200,
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All countries',
                            allSelectedText: '(All countries)',
                            numberDisplayed: 1,
                            buttonText: (options, select) => btnText(options, select, "Countries"),
                            onChange: function(option, checked, select) {
                                if (checked) {
                                    self.selectedCountries.push(option.val());
                                } else {
                                    self.selectedCountries = _.remove(self.selectedCountries, v => v != option.val())
                                }
                            },
                            onSelectAll: function() {
                                self.selectedCountries = self.country_options;
                            },
                            onDeselectAll: function() {
                                self.selectedCountries = [];
                            }
                        };

                        var waCategoryMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2 ',
                            maxHeight: 200,
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All categories',
                            allSelectedText: '(All categories)',
                            numberDisplayed: 1,
                            buttonText: (options, select) => btnText(options, select, "World Ranking"),
                            onChange: function(option, checked, select) {
                                if (checked) {
                                    self.selectedWACategories.push(option.val());
                                } else {
                                    self.selectedWACategories = _.remove(self.selectedWACategories, v => v != option.val())
                                }
                            },
                            onSelectAll: function() {
                                self.waCategories.forEach(wac => self.selectedWACategories.push(wac.value));
                            },
                            onDeselectAll: function() {
                                self.selectedWACategories = [];
                            }
                        }

                        var disciplineMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2 ',
                            maxHeight: 200,
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All disciplines',
                            allSelectedText: '(All disciplines)',
                            numberDisplayed: 1,
                            buttonText: (options, select) => btnText(options, select, "Disciplines"),
                            onChange: function(option, checked, select) {
                                if (checked) {
                                    self.selectedCompType.push(option.val());
                                } else {
                                    self.selectedCompType = _.remove(self.selectedCompType, v => v != option.val())
                                }
                            },
                            onSelectAll: function() {
                                self.compTypes.forEach(type => self.selectedCompType.push(type.value));

                            },
                            onDeselectAll: function() {
                                self.selectedCompType = [];
                            }
                        }

                        var ageGroupsMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2 ',
                            maxHeight: 200,
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All age groups',
                            allSelectedText: '(All age groups)',
                            numberDisplayed: 1,
                            buttonText: (options, select) => btnText(options, select, "Age groups"),
                            onChange: function(option, checked, select) {
                                if (checked) {
                                    self.selectedAG.push(option.val());
                                } else {
                                    self.selectedAG = _.remove(self.selectedAG, v => v != option.val())
                                }
                            },
                            onSelectAll: function() {
                                self.ageGroups.forEach(age => self.selectedAG.push(age.value));

                            },
                            onDeselectAll: function() {
                                self.selectedAG = [];
                            }
                        }

                        var eventsMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2 ',
                            maxHeight: 200,
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All  events',
                            allSelectedText: '(All events)',
                            numberDisplayed: 1,
                            enableCollapsibleOptGroups: true,
                            enableClickableOptGroups: true,
                            buttonText: (options, select) => btnText(options, select, "Events"),
                            onChange: function(option, checked, select) {
                                var selectedGroup = option instanceof Array;
                                if (checked) {
                                    if (!selectedGroup) {
                                        self.selectedEvents.push(option.val());
                                    }
                                    else if (selectedGroup) {
                                        option.forEach(o => self.selectedEvents.push(o.val()));
                                    }
                                } else {
                                    if (!selectedGroup) {
                                        self.selectedEvents = _.remove(self.selectedEvents, v => v != option.val())
                                    }
                                    else if (selectedGroup) {
                                        option.forEach(o => self.selectedEvents = _.remove(self.selectedEvents, v => v != o.val()));
                                    }
                                }
                            },
                            onSelectAll: function() {
                                self.trackEvents.forEach(ev => self.selectedEvents.push(ev.value));
                                self.fieldEvents.forEach(ev => self.selectedEvents.push(ev.value));
                                self.roadEvents.forEach(ev => self.selectedEvents.push(ev.value));
                                self.combinedEvents.forEach(ev => self.selectedEvents.push(ev.value));
                            },
                            onDeselectAll: function() {
                                self.selectedEvents = [];
                            }
                        }

                        var seriesMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2 ',
                            maxHeight: 200,
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All  groups',
                            allSelectedText: '(All groups)',
                            numberDisplayed: 1,
                            enableCollapsibleOptGroups: true,
                            enableClickableOptGroups: true,
                            buttonText: (options, select) => btnText(options, select, "Competition Grps"),
                            onChange: function(option, checked, select) {
                                var selectedGroup = option instanceof Array;
                                if (checked) {
                                    if (!selectedGroup) {
                                        self.selectedSeries.push(option.val());
                                    }
                                    else if (selectedGroup) {
                                        option.forEach(o => self.selectedSeries.push(o.val()));
                                    }
                                } else {
                                    if (!selectedGroup) {
                                        self.selectedSeries = _.remove(self.selectedSeries, v => v != option.val())
                                    }
                                    else if (selectedGroup) {
                                        option.forEach(o => self.selectedSeries = _.remove(self.selectedSeries, v => v != o.val()));
                                    }
                                }
                            },
                            onSelectAll: function() {
                                self.compSeries.forEach(grp => grp.children.forEach(series => self.selectedSeries.push(series.value)));
                            },
                            onDeselectAll: function() {
                                self.selectedSeries = [];
                            }
                        }


                        // Mobile multiselect
                        $('#m-location-choices').multiselect(locationMultiselectConfig);
                        // Desktop multiselect
                        var desktopLocationMultiselectConfig = locationMultiselectConfig;
                        desktopLocationMultiselectConfig.buttonClass = 'btn btn-link filter-button';
                        $('#location-choices').multiselect(desktopLocationMultiselectConfig);

                        // Mobile multiselect
                        $('#m-wa-category-choices').multiselect(waCategoryMultiselectConfig);
                        // Desktop multiselect
                        var desktopwaCategoryMultiselectConfig = waCategoryMultiselectConfig;
                        desktopwaCategoryMultiselectConfig.buttonClass = 'btn btn-link filter-button';
                        $('#wa-category-choices').multiselect(desktopwaCategoryMultiselectConfig);

                        // Mobile multiselect
                        $('#m-series-choices').multiselect(seriesMultiselectConfig);
                        // Desktop multiselect
                        var desktopSeriesMultiselectConfig = seriesMultiselectConfig;
                        desktopSeriesMultiselectConfig.buttonClass = 'btn btn-link filter-button';
                        $('#series-choices').multiselect(desktopSeriesMultiselectConfig);
                        
                        // Mobile multiselect
                        $('#m-discipline-choices').multiselect(disciplineMultiselectConfig);
                        // Desktop multiselect
                        var desktopdisciplineMultiselectConfig = disciplineMultiselectConfig;
                        desktopdisciplineMultiselectConfig.buttonClass = 'btn btn-link filter-button';
                        $('#discipline-choices').multiselect(desktopdisciplineMultiselectConfig);

                        // Mobile multiselect
                        $('#m-age-group-choices').multiselect(ageGroupsMultiselectConfig);
                        // Desktop multiselect
                        var desktopageGroupsMultiselectConfig = ageGroupsMultiselectConfig;
                        desktopageGroupsMultiselectConfig.buttonClass = 'btn btn-link filter-button';
                        $('#age-group-choices').multiselect(desktopageGroupsMultiselectConfig);

                        // Mobile multiselect
                        $('#m-event-choices').multiselect(eventsMultiselectConfig);
                        // Desktop multiselect
                        var desktopEventsMultiselectConfig = eventsMultiselectConfig;
                        desktopEventsMultiselectConfig.buttonClass = 'btn btn-link filter-button';
                        $('#event-choices').multiselect(desktopEventsMultiselectConfig);
                    },

                    injectDataMultiSelect: function() {
                        var self = this;
                        // Sets the options for the multiselect
                        var country_options = [];
                        self.country_options.forEach(c => country_options.push({label: c, value: c, selected: false}));
                        if (country_options.length == 0) country_options.push({label: 'No filters', value: '', selected: false});
                        // Checks if any filters where applied before changing year
                        self.selectedCountries.forEach(selcnty => country_options.forEach(cnty => { if (selcnty == cnty.value) cnty.selected = true }));
                        $('#location-choices').multiselect('dataprovider', country_options);
                        $('#m-location-choices').multiselect('dataprovider', country_options);
                        
                        var wa_category_options = [];
                        self.waCategories.forEach(c => wa_category_options.push({label: c.code, value: c.value, title: c.label, selected: false}));
                        // Checks if any filters where applied before changing year
                        self.selectedWACategories.forEach(selWAcat => wa_category_options.forEach(WAcat => { if (selWAcat == WAcat.value) WAcat.selected = true }));
                        $('#wa-category-choices').multiselect('dataprovider', wa_category_options);
                        $('#m-wa-category-choices').multiselect('dataprovider', wa_category_options);

                        var comp_series_options = self.compSeries;
                        if (comp_series_options.length == 0) comp_series_options.push({label: 'No filters', value: '', selected: false});
                        // Checks if any filters where applied before changing year
                        self.selectedSeries.forEach(selseries => comp_series_options.forEach(group => group.forEach( series => { if (selseries == series.value) series.selected = true })));
                        $('#series-choices').multiselect('dataprovider', comp_series_options);
                        $('#m-series-choices').multiselect('dataprovider', comp_series_options);

                        var type_options = [];
                        self.compTypes.forEach(t => type_options.push({label: t.label, value: t.value, selected: false}));
                        // Checks if any filters where applied before changing year
                        self.selectedCompType.forEach(seltype => type_options.forEach(type => { if (seltype == type.value) type.selected = true }));
                        $('#discipline-choices').multiselect('dataprovider', type_options);
                        $('#m-discipline-choices').multiselect('dataprovider', type_options);

                        var age_group_options = [];
                        self.ageGroups.forEach(ag => age_group_options.push({label: ag.label, value: ag.value, selected: false}));
                        // Checks if any filters where applied before changing year
                        self.selectedAG.forEach(selag => age_group_options.forEach(ag => { if (selag == ag.value) ag.selected = true }));
                        $('#age-group-choices').multiselect('dataprovider', age_group_options);
                        $('#m-age-group-choices').multiselect('dataprovider', age_group_options);

                        var event_options = [{label:'Track Events', children: []}, {label: 'Field Events', children: []}, {label: 'Road Events', children: []}, {label: 'Combined Events', children: []}];
                        self.trackEvents.forEach(e => event_options[0].children.push({label: e.label, value: e.value, title: e.title, selected: false}));
                        self.fieldEvents.forEach(e => event_options[1].children.push({label: e.label, value: e.value, title: e.title, selected: false}));
                        self.roadEvents.forEach(e => event_options[2].children.push({label: e.label, value: e.value, title: e.title, selected: false}));
                        self.combinedEvents.forEach(e => event_options[3].children.push({label: e.label, value: e.value, title: e.title, selected: false}));
                        // Checks if any filters where applied before changing year
                        self.selectedEvents.forEach(selevent => event_options.forEach(grp => grp.children.forEach(event => { if (selevent == event.value) event.selected = true })));
                        $('#event-choices').multiselect('dataprovider', event_options);
                        $('#m-event-choices').multiselect('dataprovider', event_options);


                    },

                    setFilterOptions: function() {
                        // filter options are automatically set by what is found in the data
                        var self = this;

                        // Country filter options
                        self.country_options = self.info.map(item => item.country_ioc
                                                ).filter((value, index, list) => list.indexOf(value) === index).sort();

                        // Series filter options
                        var options = [];
                        self.info.forEach(data => {
                            if (data.series) {
                                var result = data.series.map(item => {
                                    return {label: item.series_name, value: item.series_id, title: item.series_name};
                                });
                                options = options.concat(result)
                            }
                        });
                        options = options.filter((value, index, list) => list.findIndex(series => (series.value == value.value)) === index);
                        // Sorting the array againest an already sorted version
                        var sortedSeries = ['EA Events', 'WACT Eur. Spe', 'WACT Eur. Silver', 'WACT Eur. Bronze', 'WAS', 'National Senior Championships', 'International Matches']
                        var options = _.sortBy(options, function(item){
                            return sortedSeries.indexOf(item.label)
                        });
                        self.series_options = options;
                    },

                    // Pagination methods
                    setPg: function (p) {
                        this.page = p
                    },
                    mvPg: function (i) {
                        this.page += i
                    },
                    maxPages: function () {
                        var self = this,
                            total = self.filteredCompetitions.length;
                        return Math.max(1, Math.ceil(total / self.showOnPage))
                    },
                    pageStartIdx: function () {
                        var self = this,
                            maxPages = self.maxPages();
                        if (self.page > maxPages)
                            self.page = maxPages;
                        return (self.page-1) * self.showOnPage + 1;
                    },
                    pageEndIdx: function () {
                        var self = this;
                        return Math.min(self.pageStartIdx() + self.showOnPage - 1, self.filteredCompetitions.length)
                    },
                    paginatedCompetitions: function () {
                        var self = this,
                            start = self.pageStartIdx() - 1;
                        return self.filteredCompetitions.slice(start, start + self.showOnPage)
                    },
                    startPageFromToday: function() {
                        // Finds the lastest upcoming competition and sets the page to display this competition first.

                        var self = this,
                            todaysYear = new Date().getFullYear(),
                            todaysMonth = self.allMonths[new Date().getMonth()].string,
                            todaysDay = new Date().getDate(),
                            daysInMonth = new Date(todaysYear, todaysMonth, 0).getDate(),
                            found = false;
                        

                        // If no competitions are happening on todays date, then go to next day.
                        do {
                            // Going through all competitions for a page
                            // then filter by the date

                            // reset
                            self.setPg(1);
                            pageCounter = 1;

                            while (self.page <= self.maxPages() && !found) {
                                let start = self.pageStartIdx() - 1;
                                let data = self.filteredCompetitions.slice(start, start + self.showOnPage);
                                let filteredData = self.filterByDate(todaysMonth, todaysDay.toString().padStart(2, '0'), data)
                                if (filteredData.length > 0 && filteredData.length != self.info.length ) {
                                    found = true;
                                }
                                // next page
                                pageCounter++;
                                self.mvPg(1)
                            }
                            todaysDay++;
                        } while(todaysDay <= daysInMonth && !found);

                        if (found) {
                            self.setPg(pageCounter-1)
                        } else {
                            // If no competitions found, then just set to page 1
                            self.setPg(1);
                        }
                    },

                    fetchData: function() {
                        var self = this;
                        self.isLoading = true;
                        axios
                        .get(`https://s3.eu-west-2.amazonaws.com/files.opentrack.run/live/euroath/european_calendar_${self.selectedYear}.json`)
                        .then(response => {
                            self.info = response.data;
                            console.log(self.info);


                            self.setFilterOptions();

                            self.isLoading = false; 

                            if (!self.hasInitialised) {
                                self.initMap();   
                                self.initialiseMultiSelect();
                                self.hasInitialised = true;
                            }

                            self.injectDataMultiSelect();

                            self.startPageFromToday();

                            self.displaySelectedMonths();
                        })
                        .catch(error => {
                            console.log(error)
                            if (error.response) {
                                console.log(error.response);
                                if (error.response.status == 404) {
                                    // alert("No data found for this year!");
                                    $('#errorModelTitle').text(`Competition Data Error!`)
                                    $('#errorModelDescription').text(`No data found for year ${self.selectedYear}!`)
                                    $('#errorModel').modal('show')
                                }
                                else if (error.response.status >= 500 && error.response.status < 600) {
                                    // alert("Access denied to competition data!");
                                    $('#errorModelTitle').text(`Data Access Error!`)
                                    $('#errorModelDescription').text(`Unable to access competition data for year ${self.selectedYear}!`)
                                    $('#errorModel').modal('show')
                                }
                                else if (error.request) {
                                    // alert("Error making request for competition data!");
                                    $('#errorModelTitle').text(`Data Request Error!`)
                                    $('#errorModelDescription').text(`No Data file available for that year`)
                                    $('#errorModel').modal('show')
                                }
                                self.isLoading = false; 
                            }
                        })
                    }
                },
                watch: {
                    page: function() {
                        var self = this;
                        setTimeout(function(){ self.insertMonthInTable(); }, 50);
                    },
                    filteredCompetitions: function() {
                        var self = this;
                        setTimeout(function(){ self.insertMonthInTable(); }, 50);
                    }
                },
                mounted() {
                    var self = this;
                    self.fetchData();
                }
            })
        </script>
    </body>
</html>
