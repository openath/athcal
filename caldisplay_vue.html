<!doctype html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <meta name="description" content="">
        <meta http-equiv="X-UA-Compatible" content="ie=edge">
        <title>JSON Test</title>

        <!-- Font -->
        <link href="https://fonts.googleapis.com/css2?family=Roboto&display=swap" rel="stylesheet">
        <!-- FontAwesome Icons -->
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css" integrity="sha384-HzLeBuhoNPvSl5KYnjx0BT+WB0QEEqLprO+NBkkk5gbc67FTaL7XIGa2w1L0Xbgc" crossorigin="anonymous">
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" integrity="sha384-JcKb8q3iqJ61gNV9KGb8thSsNjpSL0n8PARn9HuZOnIxN0hoP+VmmDGMN5t9UJ0Z" crossorigin="anonymous">
        <!-- Bootstrap Multiselct -->
        <link rel="stylesheet" href="css/bootstrap-multiselect.min.css" type="text/css" />
        <link href="css/caldisplay_vue.css" rel="stylesheet">
        <style>
            body {
                height: 100%;
            }
            label {
                font-size: 1em;
            }
            #app {
                height: 100%;
                background-color: #F0F0F0;
            }
            .row-cols-7>* {
                -ms-flex: 0 0 14.285714285714285714285714285714%;
                flex: 0 0 14.285714285714285714285714285714%;
                max-width: 14.285714285714285714285714285714%;
            }
            .bg-orange {
                background-color: #E95420;
                color: white;
            }
            
            /* SideBar Filtering */
            .sidebar-sticky {
                max-height: 700px;
                overflow: auto;
            }
            .filter-heading {
                font-size: 1.2em;
                -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;
            }

            /* Multiselect */
            .multiselect-native-select .btn-group {
                width: 160px;
                vertical-align: middle;
            }
            .filter-button {
                color: white;
                font-weight: 500;
                text-decoration: none;
                /* margin: .5rem 1rem; */
                text-align: left;
                display: flex;
                justify-content: space-between;
                margin-left: 5px;
            }
            .filter-button .multiselect-selected-text {
                font-size: 0.8em;
                white-space: normal;
            }
            .dropdown-toggle::after {
                margin-top: 6px;
            }
            .btn-link {
                text-decoration: none;
            }
            .btn-link:hover {
                color: white;
                text-decoration: none;
            }
            .btn-link.focus, .btn-link:focus {
                text-decoration: none;
            }
            .checkbox {
                font-size: 0.8em;
            }

            .multiselect-container.dropdown-menu::-webkit-scrollbar, body::-webkit-scrollbar {
                width: 6px;
                height:6px;
                background-color: #F5F5F5;
            }
            body::-webkit-scrollbar-thumb {
                border-radius: 10px;
                -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
                background-color:#E95420;
            }
            .multiselect-container.dropdown-menu::-webkit-scrollbar-thumb {
                border-radius: 10px;
                -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,.3);
                background-color: #555;
            }
            .multiselect-container.dropdown-menu::-webkit-scrollbar-track, body::-webkit-scrollbar-track {
                -webkit-box-shadow: inset 0 0 6px rgba(0,0,0,0.3);
                border-radius: 10px;
                background-color: #F5F5F5;
            }
            
            .multiselect-container>li>a>label {
                padding: 3px 20px 3px 10px;
                display: block;
                -webkit-box-align: unset;
                -webkit-align-items: unset;
                -ms-flex-align: unset;
                align-items: unset;
                -webkit-box-pack: unset;
                -webkit-justify-content: unset;
                -ms-flex-pack: unset;
                justify-content: unset;
                margin-bottom: unset;
            }
            ul.nav.flex-column {
                position: fixed;
            }
            .dropdown-item {
                padding: .25rem 1rem;
            }
            #m-series-choices + div > div {
                min-width: 17rem;
            }
            #series-choices + div > div {
                width: 270px;
                max-width: 270px;
                transform: translate3d(-1px, 33px, 0px)!important;
		    }
            #event-choices + div > div {
                min-width: 10.5rem;
		    }
            #age-group-choices + div > div {
                max-width: 10.5rem;
		    }
            #wa-category-choices + div > div {
                max-width: 10.5rem;
		    }
            #m-wa-category-choices + div > div {
			    min-width: 11rem;
            }
            #discipline-choices + div > div {
                max-width: 10.5rem;
		    }
            #m-discipline-choices + div > div {
			    min-width: 11rem;
		    }
            .fa-chevron-up {
                font-size: 0.7em;
            }
            .form-check-label {
                font-size: 0.9em;
                white-space: normal;
                max-width: 300px;
            }
            .card-body {
                background-color: #da7652;
            }

            /* Year Filter */
            #selectedYear {
                color: #E95420;
                -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;
            }
            #selectedYear>i {
                font-size: 0.8em;
            }
            #selectedYear>i:hover {
                color: #707070;
                cursor: pointer;
            }
            
            /* Month Filter */
            .month-heading {
                color: #707070;
                text-decoration: underline;
                -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;
            }
            .month-heading:hover {
                color: #E95420;
                cursor: pointer;
            }
            /* Month Filter (table row) */
            .table-row-month {
                background-color: #F0F0F0;
            }

            /* LightBox Competition Details */
            .modal-header > h6 {
                font-size: 1rem;
            }

            /* LightBox / Competition Detail */
            .list-group-item h6 {
                font-size: 0.9rem; 
            }
            #eventTable {
                width: 200px;
            }
            #eventTable td , #eventTable th {
                padding: 0.25rem;
            }

            /* Pagination */
            .page-item {
                cursor: pointer;
            }
            .page-link {
                -moz-user-select: none; -webkit-user-select: none; -ms-user-select:none; user-select:none;-o-user-select:none;
            }
            /* The animation code */
            @keyframes chevron-flip {
                0% {transform: rotate(0deg);}
                100% {transform: rotate(180deg);}
            }
            .chevron-animate-up {
                animation-name: chevron-flip;
                animation-iteration-count: 1;
                animation-duration: 0.4s;
                animation-fill-mode: forwards;
                animation-direction: normal;
            }
            .chevron-animate-down {
                animation-name: chevron-flip;
                animation-iteration-count: 1;
                animation-duration: 0.4s;
                animation-fill-mode: forwards;
                animation-direction: reverse;
            }
            .bd-placeholder-img {
                font-size: 1.125rem;
                text-anchor: middle;
                -webkit-user-select: none;
                -moz-user-select: none;
                -ms-user-select: none;
                user-select: none;
            }
            @media (min-width: 768px) {
                .bd-placeholder-img-lg {
                    font-size: 3.5rem;
                }
            }
            @media (min-width: 992px) {
                .row-cols-lg-7>* {
                    -ms-flex: 0 0 14.285714285714285714285714285714%;
                    flex: 0 0 14.285714285714285714285714285714%;
                    max-width: 14.285714285714285714285714285714%;
                }
            }
        </style>
        <!-- Custom styles for this template -->
    </head>
    <body>
        <div id="app">
            <div class="container-fluid">
                <div class="row">
                    <nav id="sidebarMenu" class="col-md-3 col-lg-2 d-md-block sidebar collapse" style="background-color: #E95420;">
                        <div class="sidebar-sticky pt-3">
                            <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
                                <span class="text-white">Filter</span>
                                <!-- <a class="d-flex align-items-center text-muted" href="#" aria-label="Add a new report">
                                    <span data-feather="plus-circle"></span>
                                </a> -->
                            </h6>
                            
                            <div class="form-group">
                                <input class="form-control" v-model="name_search_query" type="text" placeholder="Search name">
                            </div>
                            <ul class="nav flex-column">
                                <li class="nav-item">
                                    <select name="location" id="location-choices"  multiple="multiple"></select>
                                </li>
                                <li class="nav-item">
                                    <select name="wa-category" id="wa-category-choices"  multiple="multiple"></select>
                                </li>
                                <li class="nav-item">
                                    <select name="Series" id="series-choices"  multiple="multiple"></select>
                                </li>
                                <li class="nav-item">
                                    <select name="discipline" id="discipline-choices"  multiple="multiple"></select>
                                </li>
                                <li class="nav-item">
                                    <select name="age-groups" id="age-group-choices"  multiple="multiple"></select>
                                </li>
                                <li class="nav-item">
                                    <select name="events" id="event-choices"  multiple="multiple"></select>
                                </li>
                            </ul>
                        </div>
                    </nav>

                    <main role="main" class="col-md-9 ml-sm-auto col-lg-10 px-md-4">
                        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center ">
                            <div id="selectedYearContainer" class="mx-auto">
                                <h1 id="selectedYear" class="d-inline">
                                    <i class="fas fa-angle-left mx-2" @click="decrementYear()"></i>
                                    {{ selectedYear }}
                                    <i class="fas fa-angle-right mx-2" @click="incrementYear()"></i>
                                </h1>
                            </div>
                            <!-- <div class="btn-toolbar mb-2 mb-md-0 d-none d-md-block" style="position: absolute;right:20px;">
                                <div class="btn-group mr-2">
                                    <button type="button" class="btn btn-sm btn-outline-secondary" data-toggle="collapse" data-target="#eventDays" aria-expanded="false" aria-controls="eventDays">Calendar View</button>
                                    <button type="button" class="btn btn-sm btn-outline-secondary">Map View</button>
                                </div>
                            </div> -->
                        </div>

                        <!-- Toggles show/hide of filters -->
                        <a class="btn btn-primary btn-sm d-sm-block d-md-none mb-1" data-toggle="collapse" href="#mobileFilter" role="button" aria-expanded="false" aria-controls="mobileFilter">
                            <i class="fas fa-filter"></i>
                        </a>

                        <!-- Data is injected into multiselct through 'initialiseMultiSelect' -->
                        <div id="mobileFilter" class="collapse">
                            <select name="location" id="m-location-choices" multiple="multiple"></select>
                            <select name="wa-category" id="m-wa-category-choices" multiple="multiple"></select>
                            <select name="series" id="m-series-choices" multiple="multiple"></select>
                            <select name="discipline" id="m-discipline-choices" multiple="multiple"></select>
                            <select name="age_group" id="m-age-group-choices" multiple="multiple"></select>
                            <select name="events" id="m-event-choices" multiple="multiple"></select>
                        </div>

                        <!-- Shows each month -->
                        <div id="months-headings" class="d-none d-md-flex row pt-3 pb-2 mb-3 border-bottom">
                            <div class="col-md-1 d-md-inline" v-for="month in months_data" >
                                <h5 class="month-heading d-block mb-0 text-center" v-on:click="applyDateFilter(month)">{{ month.name }}</h5>
                                <div class="d-block mx-auto" style="width:fit-content">
                                    <span class="badge badge-pill badge-secondary">{{ month.numberOfComps }}</span>
                                </div>
                            </div>
                        </div>

                        <!-- Shows each day of each month -->
                        <div id="eventDays" class="row row-cols-7 collapse">
                            <div class="col p-3" v-for="n in 42">
                                <div class="border border-dark">
                                    <h3>{{ n }}</h3>
                                </div>
                            </div>
                        </div>
                        
                        <div class="d-flex flex-horizontal justify-content-between align-items-center">
                            <div>
                                <span v-if="filteredCompetitions" class="badge badge-secondary mb-0">{{ filteredCompetitions.length || 0 }} of {{ info && info.length || 0 }} competitions</span>
                                <a class="d-block d-md-inline" href="javascript:location.reload(true)">Reset filters</a>
                            </div>
                            <navigator class="float-right" :is-loading="isLoading" :total="filteredCompetitions && filteredCompetitions.length || 0" @movePage="mvPg" @changePage="setPg" :results-per-page="showOnPage"></navigator>
                        </div>
                        <div class="table-responsive">
                            <table id="competitionTable" class="table table-sm list bg-white">
                                <thead class="bg-primary text-white">
                                    <tr>
                                        <th scope="col" class="d-lg-table-cell">Date</th>
                                        <th scope="col">Full Name</th>
                                        <th class="d-none d-lg-table-cell text-center" scope="col">Age Groups</th>
                                        <th class="d-none d-lg-table-cell text-center" scope="col">WA Cat</th>
                                        <th class="d-none d-lg-table-cell text-center" scope="col">Country</th>
                                        <th class="text-center" scope="col">Discipline</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr v-if="paginatedCompetitions().length == 0">
                                        <td>No competitions</td>
                                    </tr>
                                    <tr v-for="comp in paginatedCompetitions()"  :key="comp.id">
                                        <td style="width:125px">{{comp.date}}</td>
                                        <td><a href="" @click="showCompetitionDetails(comp)" data-toggle="modal" data-target="#competitionDetailModel">{{comp.full_name}}</a></td>
                                        <td class="d-none d-lg-table-cell text-center">{{comp.age_groups}}</td>
                                        <td class="d-none d-lg-table-cell text-center">{{ getCategoryCode(comp.wa_rankings_category) }}</td>
                                        
                                        <td class="d-none d-lg-table-cell text-center">{{comp.country_ioc}}</td>
                                        <td class="text-center">{{comp.type}}</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <nav class="d-flex justify-content-center">
                            <navigator class="float-right" :is-loading="isLoading" :total="filteredCompetitions && filteredCompetitions.length || 0" @movePage="mvPg" @changePage="setPg" :results-per-page="showOnPage"></navigator>
                        </nav>
                    </main>
                </div>
            </div>
        
            <!-- Competition Modal/Lightbox -->
            <div class="modal fade" id="competitionDetailModel" tabindex="-1" aria-labelledby="competitionDetailModel" aria-hidden="true">
                <div class="modal-dialog modal-lg modal-dialog-centered">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="competitionDetailName">{{ selectedCompetition.full_name }} <h6 v-if="selectedCompetition.name_local != ''" class="blockquote-footer my-auto mx-2">{{ selectedCompetition.name_local }}</h6></h5>
                            
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body">
                            <div class="row">
                                <div class="col">{{ selectedCompetition.basic_description }}</div>
                            </div>
                            <div class="row">
                                <div class="col">
                                    <ul class="list-group">
                                        <li class="list-group-item d-flex align-items-center"><h6 class="mr-auto my-0">Contact Name</h6>
                                            <span v-if="selectedCompetition.contact_name !=''" class="badge badge-primary badge-pill">{{ selectedCompetition.contact_name }}</span>
                                            <span v-else >None</span>
                                        </li>
                                        <li class="list-group-item d-flex align-items-center"><h6 class="mr-auto my-0">Contact Details</h6>
                                            <span v-if="selectedCompetition.contact_details !=''" class="badge badge-primary badge-pill">{{ selectedCompetition.contact_details }}</span>
                                            <span v-else >None</span>
                                        </li>
                                        <li class="list-group-item d-flex align-items-center"><h6 class="mr-auto my-0">Dates</h6> 
                                            <a>
                                                From <span class="badge badge-success badge-pill">{{ selectedCompetition.date }}</span> 
                                                To <span class="badge badge-danger badge-pill">{{ selectedCompetition.finish_date }}</span>
                                            </a>
                                        </li>
                                        <li class="list-group-item d-flex align-items-center">
                                            <h6 class="mr-auto my-0">Events detail</h6> 
                                            <table id="eventTable" class="table table-borderless">
                                                <thead>
                                                    <tr>
                                                      <th scope="col">Code</th>
                                                      <th scope="col">Genders</th>
                                                      <th scope="col">Age</th>
                                                    </tr>
                                                  </thead>
                                                <body>
                                                    <tr v-for="e in selectedCompetition.events"><td>{{ e.event_code }}</td><td>{{ e.genders }}</td><td>{{ e.age_groups }}</td></tr>
                                                </body>
                                            </table>
                                        </li>
                                        <li class="list-group-item d-flex align-items-center">
                                            <h6 class="mr-auto my-0">Competitors</h6>
                                            <a v-if="selectedCompetition.ot_supported" href="" class="px-3">Click here</a>
                                            <span class="badge badge-primary badge-pill">{{ selectedCompetition.num_competitors }}</span>
                                        </li>
                                        <li class="list-group-item d-flex align-items-center">
                                            <h6 class="mr-auto my-0">Results</h6>
                                            <a v-if="selectedCompetition.ot_supported" href="" class="px-3">Click here</a>
                                            <a v-else href="selectedCompetition.results_link" class="px-3">Click here</a>
                                            <span class="badge badge-primary badge-pill">{{ selectedCompetition.num_results }}</span>
                                        </li>
                                        <li v-if="selectedCompetition.website != ''" class="list-group-item d-flex align-items-center">
                                            <h6 class="mr-auto my-0">Website</h6>
                                            <a  :href="selectedCompetition.website" class="px-3">Click here</a>
                                            <span class="badge badge-primary badge-pill invisible">44</span>
                                        </li>
                                      </ul>
                                </div>
                                <div class="col">
                                    <div id="map" class="w-100" style="height:300px"></div>
                                </div>
                            </div>
                            
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Error Modal - displays error when fetching data -->
            <div class="modal fade show" id="errorModel" data-backdrop="static" data-keyboard="false" tabindex="-1" aria-labelledby="errorModel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="errorModelTitle">"Error title"</h5>
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                        </div>
                        <div class="modal-body" id="errorModelDescription">
                            "error message"
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>


        <!-- Navigator -->
        <script type="text/template" id="navigator_template">
            <ul class="pagination mr-0 my-1" v-if="isLoading || total > resultsPerPage" v-cloak>
                <li :class="{'page-item': true, disabled: $parent.page == 0}">
                    <a class="page-link" @click="prevPage" aria-label="Previous">
                        <span aria-hidden="true" class="d-none d-lg-inline-block hidden-xs hidden-sm hidden-md">Prev</span>
                        <span class="d-inline-block d-lg-none hidden-lg">&laquo;</span>
                    </a>
                </li>
                <!--  partial -->
                <li v-if="numPages > threshold && $parent.page > 2" :class="{'page-item': true, active: $parent.page == 1}"><a class="page-link" @click="setPage(1)">1</a></li>
                <li v-if="numPages > threshold && $parent.page > 3" class="page-item disabled"><span class="page-link">...</span></li>
                <li v-if="numPages > threshold" v-for="pi in _.range(Math.max(1, $parent.page - 1), Math.min(numPages, $parent.page + 2) + 1)"
                    :class="{'page-item': true, active: $parent.page == pi}">
                    <a @click="setPage(pi)" class="page-link">{{ pi }}</a>
                </li>
                <li v-if="numPages > threshold && $parent.page < numPages - 3" class="page-item disabled"><span class="page-link">...</span></li>
                <li v-if="numPages > threshold && $parent.page < numPages - 2" class="page-item"><a class="page-link" @click="setPage(numPages)">{{ numPages }}</a></li>
                <li v-else-if="numPages <= threshold" v-for="i in _.range(1, numPages+1)" :class="{'page-item': true, active: $parent.page == i}">
                    <a @click="setPage(i)" class="page-link">{{ i }}</a>
                </li>
                <li :class="{'page-item': true, disabled: $parent.page == numPages}">
                    <a class="page-link" @click="nextPage" aria-label="Next">
                        <span aria-hidden="true" class="d-none d-lg-inline-block hidden-xs hidden-sm hidden-md">
                            <span v-if="isLoading"><img src="./img/ajax-loading.gif" alt="Loading" /> Loading ...</span>
                            <span v-else>Next</span>
                        </span>
                        <span class="d-inline-block d-lg-none hidden-lg">
                            <span v-if="isLoading"><img src="./img/ajax-loading.gif" alt="Loading" /> Loading ...</span>
                            <span v-else>&raquo;</span>
                        </span>
                    </a>
                </li>
            </ul>
        </script>
        <!-- Bootstrap JS, Popper.js, and jQuery -->
        <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js" integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj" crossorigin="anonymous"></script>
        <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js" integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js" integrity="sha384-B4gt1jrGC7Jh4AgTPSdUtOBvfO8shuf57BaghqFfPlYxofvL8/KUEfYiJOMMV+rV" crossorigin="anonymous"></script>
        
        <!-- Bootstrap Multiselct JS -->
        <script type="text/javascript" src="./js/bootstrap-multiselect.js"></script>
        
        <!-- Google Maps API -->
        <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDNwYdWaTG9yfjZydsHKW3tnm-rn8f30sw&libraries=places"></script>
        <!-- Vue -->
        <script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
        <!-- Axios -->
        <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
        <!-- Lodash -->
        <script src="./js/lodash.js"></script>
        <!-- Paginator JS -->
        <script src="./js/navigator-script.js"></script>
        <script>
            $(document).ready(() => {
                // Handles toggling of show/hide animations for filter options
                // Toggles the collapse of filters
                $(".filter-heading.d-block.text-white").click(function(){
                    $(this).next().collapse('toggle');
                });
                $('.collapse').on('show.bs.collapse', function() {
                    var chevron = $(this).prev().children('i');
                    chevron.addClass('chevron-animate-up');
                    setTimeout(() => {
                        chevron.removeClass('chevron-animate-down');
                        var rotate = chevron.css('transform');
                        chevron.css('transform', rotate);
                        chevron.removeClass('chevron-animate-up');
                    }, 500);
                });
                $('.collapse').on('hide.bs.collapse', function() {
                    var chevron = $(this).prev().children('i');
                    chevron.addClass('chevron-animate-down');
                    setTimeout(() => {
                        chevron.removeClass('chevron-animate-up');
                        var rotate = chevron.css('transform');
                        chevron.css('transform', rotate);
                        chevron.removeClass('chevron-animate-down');
                    }, 500);
                });
            });

            var app = new Vue({
                el: '#app',
                props: {
                    waCategories: {
                        type: Array,
                        default: function() {
                            return [{label:'Olympic Games & World Championships', code:'OW', value:1}, {label:'Diamond League Finals', code:'DF', value:2}, {label:'World specialist championships (e.g. indoor), DLs', code:'GW', value:3}, {label:'Platinum and Gold Label', code:'GL', value:4}, {label:'Major Games, WACT Gold', code:'A', value:5}, {label:'WACT Silver, ETCH, National Champs', code:'B', value:6}, {label:'WA U20, WACT Bronze, Area 3rd Tier', code:'C', value:7}, {label:'Traditional International, National Senior Indoor', code:'D', value:8}, {label:"Int'l Matches, Selected National Meetings", code:'E', value:9}, {label:'International Meetings with National Permit', code:'F', value:10}, {label:'Unclassified but of international interest', code:'Unclassified', value:11}];
                        } 
                    },
                    compSeries: {	
                        type: Array,	
                        default: function() {	
                            return [{label:'WA Major Events', value:'6', title: 'WA Major Events'}, {label:'Diamond League', value:'8', title: 'Diamond League'}, {label:'WACT Gold', value:'1', title: 'WACT Europe Gold Meetings'}, {label:'EA Major Events', value:'5', title: 'European Athletics Major Events'}, {label:'WACT Silver', value:'2', title: 'WACT Europe Silver Meetings'}, {label:'WACT Bronze', value:'3', title: 'WACT Europe Bronze Meetings'}, {label:'WA Permits', value:'9', title: 'WA Permits'}, {label:'EA Permits', value:'10', title: 'EA Permits'}, {label:'National Championships', value:'4', title: 'National Championships'}, {label:'National Permits', value:'11', title: 'National Permits'}, {label:'International Matches', value:'7', title: 'International Matches'}, {label:'Other international events', value:'12', title: 'Other international events'}, {label:'Other national events', value:'13', title: 'Other national events'}];	
                        }	
                    },
                    ageGroups: {
                        type: Array,
                        default: function () {
                            return [{label:'Seniors',value:'SEN'}, {label:'Masters',value:'M'}, {label:'U23',value:'U23'}, {label:'U20',value:'U20'}, {label:'U18',value:'U18'}]
                        }
                    },
                    compTypes: {
                        type: Array,
                        default: function () {
                            return [{label:'Outdoor', value:'TRACK'}, {label:'Indoor', value:'INDOOR'}, {label:'Road races', value:'ROAD'}, {label:'Cross country', value:'XC'}, {label:'Mountain running', value:'MOUNTAIN'}, {label:'Race walking', value:'WALK'}]
                        }
                    },
                    events: {
                        type: Array,
                        default: function () {
                            return [{label: '60m', value: '60', title: '60 Metres'}, {label: '100m', value: '100', title: '100 Metres'}, {label: '200m', value: '200', title: '200 Metres'}, {label: '400m', value: '400', title: '400 Metres'}, {label: '800m', value: '800', title: '800 Metres'}, {label: '1500m', value: '1500', title: '1500 Metres'}, {label: '3000m', value: '3000', title: '3000 Metres'}, {label: '5000m', value: '5000', title: '5000 Metres'}, {label: '10,000m', value: '10000', title: '10,000 Metres'}, {label: 'Half-Marathon', value: 'HM', title: 'Half Marathon (21.0975km)'}, {label: 'Marathon', value: 'MAR', title: 'Marathon (42.195km)'}, {label: '2000m Steelechase', value: '2000SC', title: '2000 Metres Steelechase'}, {label: '3000m Steelechase', value: '3000SC', title: '3000 Metres Steelechase'}, {label: '60mH', value: '60H', title: '60 Metres Hurdles'}, {label: 'High Jump', value: 'HJ'}, {label: 'Pole Vault', value: 'PV'}, {label: 'Long Jump', value: 'LJ'}, {label: 'Triple Jump', value: 'TJ'}, {label: 'Shot Put', value: 'SP'}, {label: 'Discus', value: 'DT'}, {label: 'Hammer', value: 'HT'}, {label: 'Javelin', value: 'JT'}, {label: 'Pentathlon', value: 'PEN'}, {label: 'Heptathlon', value: 'HEP'},  {label: 'Decathlon', value: 'DEC'}, {label: '20km Walk', value: '20KW'}, {label: '4X100m Relay', value: '4X100'}]
                        }
                    },
                    allMonths: {
                        type: Array,
                        default: function () {
                            return ['JAN', 'FEB', 'MAR', 'APR', 'MAY', 'JUN', 'JUL', 'AUG', 'SEP', 'OCT', 'NOV', 'DEC']
                        }
                    },
                    pageSize: {
                        type: Number,
                        default: function () { return 50 }
                    }
                },
                data() {
                    return {
                        info: [],
                        name_search_query: '',
                        all_months: [],
                        series_options: [],
                        country_options: [],
                        selectedYear: new Date().getFullYear(),
                        selectedMonths: [],
                        selectedCompType: [],
                        selectedAG: [],
                        selectedCountries: [],
                        selectedWACategories: [],
                        selectedSeries: [],
                        selectedCompetition: {},
                        selectedEvents: [],

                        map: {},
                        mapFinder: {},
                        

                        showOnPage: 16,
                        page: 1,
                        isLoading: true,
                        hasInitialised: false,
                    }
                },
                computed: {
                    filteredCompetitions: function () {
                        var self = this,
                            output = self.info || [];

                        if (self.name_search_query != '') {
                            output = output.filter(function (item) {
                                return item.full_name.toLowerCase().includes(self.name_search_query.toLowerCase())
                            })
                        }
                        if (self.selectedCountries.length > 0) {
                            output = output.filter(function (item) {
                                return self.selectedCountries.indexOf(item.country_ioc) >= 0
                            })
                        }
                        if (self.selectedCompType.length > 0) {
                            output = output.filter(function (item) {
                                return self.selectedCompType.indexOf(item.type) >= 0
                            })
                        }
                        if (self.selectedAG.length > 0) {
                            output = output.filter(function (item) {
                                var ageGroups = item.age_groups.split(',').map(function(ag) { return ag.trim() });
                                var hits = ageGroups.map(function (ag) {
                                    return self.selectedAG.indexOf(ag) >= 0
                                })
                                return hits.reduce(function (x, y) { return x || y }, false)
                            })
                        }
                        if (self.selectedYear) {
                            output = self.filterByDate(null, output)
                        }
                        if (self.selectedMonths.length > 0) {
                            var list = [];
                            self.selectedMonths.forEach(month => list = list.concat(self.filterByDate(month.string, output)));
                            output = list;
                        }
                        if (self.selectedWACategories.length > 0) {
                            output = output.filter(function (item) {
                                return self.selectedWACategories.indexOf(item.wa_rankings_category.toString()) >= 0
                            })
                        }
                        if (self.selectedEvents.length > 0) {
                            output = output.filter(function (item) {
                                return item.events ? item.events.some(e=> self.selectedEvents.indexOf(e.event_code) >= 0) : false
                            })
                        }
                        if (self.selectedSeries.length > 0) {
                            console.log(self.selectedSeries)
                            output = output.filter(function (item) {
                                return item.series ? item.series.some(e=> self.selectedSeries.indexOf(e.series_id.toString()) >= 0) : false
                            })
                        }
                        return output
                    },
                    months_data: function() {
                        var self = this;
                        self.all_months = [];
                        if (self.info) {
                            for (month in self.allMonths) {
                                var monObject = {
                                    num: parseInt(month)+1,
                                    name: self.allMonths[month],
                                    string: String(parseInt(month)+1).padStart(2, '0')
                                };
                                var compList = self.filterByDate(monObject.string);
                                monObject.numberOfComps = compList.length;
                                self.all_months.push(monObject);
                            }
                        }
                        var output = self.all_months;
                        return output;
                    }
                },
                methods:{
                    incrementYear: function() {
                        var self = this;
                        self.selectedYear++;
                        self.fetchData();
                    },
                    decrementYear: function() {
                        var self = this;
                        self.selectedYear--;
                        self.fetchData();
                    },
                    resetFilters: function() {
                        var self = this;
                        self.selectedMonths = [];
                        self.selectedCompType = [];
                        self.selectedAG = [];
                        self.selectedCountries = [];
                        self.selectedWACategories = [];
                        self.selectedSeries = [];
                        self.selectedCompetition = {};
                        self.selectedEvents = [];

                        self.displaySelectedMonths();
                        self.clearMonthsInTable();
                    },
                    applyDateFilter: function(month) {
                        var self = this;

                        // Check if month is contained in list
                        if (self.selectedMonths.some(e => e === month)) {
                            // Remove it
                            var selMonths = self.selectedMonths;
                            self.selectedMonths = selMonths.filter((mon) => mon.num != month.num);
                            self.removeMonthInTable(month);
                        } else {
                            // Add it
                            self.selectedMonths.push(month);
                            self.insertMonthInTable();
                        }
                        self.displaySelectedMonths();
                    },
                    displaySelectedMonths: function() {
                        var self = this;
                        // Diplays which month is currently being filtered by
                        var calMonths = document.getElementById('months-headings');
                        Array.from(calMonths.children).forEach(mon => mon.children[0].style.color = "#707070");

                        self.selectedMonths.forEach((month) => {
                            var clickedMonth = calMonths.children[month.num-1];
                            clickedMonth.children[0].style.color = "#E95420";
                        });
                    },

                    insertMonthInTable: function() {
                        var self = this;
                        var competitions = self.paginatedCompetitions();
                        // console.log("Insert");
                        // console.log(competitions);

                        // var month = self.selectedMonths.slice(-1)[0];
                        var totalNumberOfcomps = 0;
                        var rowPosition = 0;
                        var addedMonths = [];

                        // Clear table of months first
                        self.clearMonthsInTable();
                        for (const month of self.selectedMonths) {
                            var html =  `<tr class="table-row-month"><th scope="row" colspan="6">${month.name}</th></tr>`;
                            var monthIndex = self.selectedMonths.indexOf(month);

                            // Inserts months selected after first
                                // console.log(competitions.length, month.numberOfComps);
                                // insertRowLocation = (preMonthCompLength);
                            if (monthIndex > 0) {
                                rowPosition = totalNumberOfcomps+(monthIndex-1);
                            }
                            // console.log(totalNumberOfcomps);
                            for (const comp in competitions) {
                                var number = parseInt(comp)+1;
                                // console.log(addedMonths.indexOf(month) == -1);
                                // console.log(competitions[comp].date.match(`${self.selectedYear}-${month.string}`));

                                if (addedMonths.indexOf(month) == -1 && competitions[comp].date.match(`${self.selectedYear}-${month.string}`)) {
                                    // console.log("inserting row");
                                    // console.log(rowPosition);
                                    if (addedMonths.length != 0) {
                                        $('#competitionTable > tbody > tr').eq(rowPosition).after(html);
                                    } else {
                                        $('#competitionTable > tbody > tr').eq(0).before(html);
                                    }
                                    addedMonths.push(month);               
                                }
                            }
                            totalNumberOfcomps += self.filterByDate(month.string, competitions).length;
                        
                        }
                    },
                    clearMonthsInTable: function() {
                        var self = this;
                        $('#competitionTable > tbody').children('tr').each((i, element) => {
                            for (const month of self.selectedMonths) {
                                if ($(element).text() == month.name) {
                                    $(element).remove();
                                }
                            }
                        });
                    },
                    removeMonthInTable: function(month) {
                        var self = this;
                        $('#competitionTable > tbody').children('tr').each((i, element) => {
                            if ($(element).text() == month.name) {
                                $(element).remove();
                            }
                        });
                        self.insertMonthInTable();
                    },

                    filterByDate: function(month, data) {
                        var output, self=this;
                        if (data) {
                            output = data;
                        } else {
                            output = this.info;
                        }
                        if (month) {
                            var result = output.filter((item)=>{
                                // Need to change this to selectedYear
                                return item.date.match(`${self.selectedYear}-${month}`);
                            })
                            // console.log(result);
                            return result;
                        } else {
                            return output.filter((item)=>{
                                // Need to change this to selectedYear
                                return item.date.match(`${self.selectedYear}`);
                            })
                        }
                    },
                    getCategoryCode: function(number) {
                        var self = this;
                        var output = self.waCategories.find(item => item.value == number)
                        return output.code;
                    },

                    // Show competition detail when clicked on competition
                    showCompetitionDetails: function(comp) {
                        var self = this;
                        self.selectedCompetition=comp;
                        // console.log(self.map);
                        if (self.selectedCompetition.address != "") {
                            $('#map').show();
                            self.updateMap(self.selectedCompetition.address);
                        } else {
                            $('#map').hide();
                        }
                    },

                    // Google maps methods
                    initMap: function() {
                        var self = this;
                        self.map = new google.maps.Map(document.getElementById("map"), {
                            center: null,
                            zoom: 8,
                        });
                        self.mapFinder = new google.maps.places.PlacesService(self.map);
                    },
                    updateMap: function(address) {
                        var self = this;
                        self.findPlace(address);
                    },
                    findPlace: function(address) {
                        var self = this;
                        const request = {
                            query: address,
                            fields: ["name", "geometry"],
                        };
                        self.mapFinder.findPlaceFromQuery(request, (results, status) => {
                            if (status === google.maps.places.PlacesServiceStatus.OK) {
                                self.map.setCenter(results[0].geometry.location);
                                self.createMarker(results[0]);
                            }else {
                                console.log("Google Maps: Could not get location");
                            }
                        });
                    },
                    createMarker: function(place) {
                        var self = this, map = self.map;
                        const marker = new google.maps.Marker({
                            map,
                            position: place.geometry.location,
                        });
                    },

                    // Initialisation of multiselect filtering buttons
                    initialiseMultiSelect: function() {
                        var self = this;
                        // Multiselect Buttons

                        var locationMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2',
                            maxHeight: 200,
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All countries',
                            allSelectedText: '(All countries)',
                            numberDisplayed: 1,
                            buttonText: function(options, select) {
                                if (options.length == 1) {
                                    return options.html();
                                }
                                else {
                                    return `Countries (${options.length})`;
                                }
                            },
                            onChange: function(option, checked, select) {
                                if (checked) {
                                    self.selectedCountries.push(option.val());
                                } else {
                                    self.selectedCountries = _.remove(self.selectedCountries, v => v != option.val())
                                }
                            },
                            onSelectAll: function() {
                                self.selectedCountries = [];
                            },
                            onDeselectAll: function() {
                                self.selectedCountries = [];
                            }
                        };

                        var waCategoryMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2',
                            maxHeight: 200,
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All categories',
                            allSelectedText: '(All categories)',
                            numberDisplayed: 1,
                            buttonText: function(options, select) {
                                if (options.length == 1) {
                                    return options.html();
                                }
                                else {
                                    return `World Ranking Categories (${options.length})`;
                                }
                            },
                            onChange: function(option, checked, select) {
                                if (checked) {
                                    self.selectedWACategories.push(option.val());
                                } else {
                                    self.selectedWACategories = _.remove(self.selectedWACategories, v => v != option.val())
                                }
                            },
                            onSelectAll: function() {
                                self.selectedWACategories = [];
                            },
                            onDeselectAll: function() {
                                self.selectedWACategories = [];
                            }
                        }

                        var disciplineMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2',
                            maxHeight: 200,
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All disciplines',
                            allSelectedText: '(All disciplines)',
                            numberDisplayed: 1,
                            buttonText: function(options, select) {
                                if (options.length == 1) {
                                    return options.html();
                                }
                                else {
                                    return `Disciplines (${options.length})`;
                                }
                            },
                            onChange: function(option, checked, select) {
                                if (checked) {
                                    self.selectedCompType.push(option.val());
                                } else {
                                    self.selectedCompType = _.remove(self.selectedCompType, v => v != option.val())
                                }
                            },
                            onSelectAll: function() {
                                self.selectedCompType = [];
                            },
                            onDeselectAll: function() {
                                self.selectedCompType = [];
                            }
                        }

                        var ageGroupsMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2',
                            maxHeight: 200,
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All age groups',
                            allSelectedText: '(All age groups)',
                            numberDisplayed: 1,
                            buttonText: function(options, select) {
                                if (options.length == 1) {
                                    return options.html();
                                }
                                else {
                                    return `Age groups (${options.length})`;
                                }
                            },
                            onChange: function(option, checked, select) {
                                if (checked) {
                                    self.selectedAG.push(option.val());
                                } else {
                                    self.selectedAG = _.remove(self.selectedAG, v => v != option.val())
                                }
                            },
                            onSelectAll: function() {
                                self.selectedAG = [];
                            },
                            onDeselectAll: function() {
                                self.selectedAG = [];
                            }
                        }

                        var eventsMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2',
                            maxHeight: 200,
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All  events',
                            allSelectedText: '(All events)',
                            numberDisplayed: 1,
                            buttonText: function(options, select) {
                                if (options.length == 1) {
                                    return options.html();
                                }
                                else {
                                    return `Events (${options.length})`;
                                }
                            },
                            onChange: function(option, checked, select) {
                                console.log("change")
                                if (checked) {
                                    self.selectedEvents.push(option.val());
                                } else {
                                    self.selectedEvents = _.remove(self.selectedEvents, v => v != option.val())
                                }
                            },
                            onSelectAll: function() {
                                self.selectedEvents = [];
                            },
                            onDeselectAll: function() {
                                self.selectedEvents = [];
                            }
                        }

                        var seriesMultiselectConfig = {
                            buttonClass: 'btn btn-primary btn-sm mb-2',
                            maxHeight: 200,
                            includeSelectAllOption: true,
                            selectAllValue: 'ALL',
                            selectAllText: 'All  groups',
                            allSelectedText: '(All groups)',
                            numberDisplayed: 1,
                            buttonText: function(options, select) {
                                if (options.length == 1) {
                                    return options.html();
                                }
                                else {
                                    return `Competition Groups (${options.length})`;
                                }
                            },
                            onChange: function(option, checked, select) {
                                console.log("change")
                                if (checked) {
                                    self.selectedSeries.push(option.val());
                                } else {
                                    self.selectedSeries = _.remove(self.selectedSeries, v => v != option.val())
                                }
                            },
                            onSelectAll: function() {
                                self.selectedSeries = [];
                            },
                            onDeselectAll: function() {
                                self.selectedSeries = [];
                            }
                        }


                        // Mobile multiselect
                        $('#m-location-choices').multiselect(locationMultiselectConfig);
                        // Desktop multiselect
                        var desktopLocationMultiselectConfig = locationMultiselectConfig;
                        desktopLocationMultiselectConfig.buttonClass = 'btn btn-link filter-button';
                        $('#location-choices').multiselect(desktopLocationMultiselectConfig);

                        // Mobile multiselect
                        $('#m-wa-category-choices').multiselect(waCategoryMultiselectConfig);
                        // Desktop multiselect
                        var desktopwaCategoryMultiselectConfig = waCategoryMultiselectConfig;
                        desktopwaCategoryMultiselectConfig.buttonClass = 'btn btn-link filter-button';
                        $('#wa-category-choices').multiselect(desktopwaCategoryMultiselectConfig);

                        // Mobile multiselect
                        $('#m-series-choices').multiselect(seriesMultiselectConfig);
                        // Desktop multiselect
                        var desktopSeriesMultiselectConfig = seriesMultiselectConfig;
                        desktopSeriesMultiselectConfig.buttonClass = 'btn btn-link filter-button';
                        $('#series-choices').multiselect(desktopSeriesMultiselectConfig);
                        
                        // Mobile multiselect
                        $('#m-discipline-choices').multiselect(disciplineMultiselectConfig);
                        // Desktop multiselect
                        var desktopdisciplineMultiselectConfig = disciplineMultiselectConfig;
                        desktopdisciplineMultiselectConfig.buttonClass = 'btn btn-link filter-button';
                        $('#discipline-choices').multiselect(desktopdisciplineMultiselectConfig);

                        // Mobile multiselect
                        $('#m-age-group-choices').multiselect(ageGroupsMultiselectConfig);
                        // Desktop multiselect
                        var desktopageGroupsMultiselectConfig = ageGroupsMultiselectConfig;
                        desktopageGroupsMultiselectConfig.buttonClass = 'btn btn-link filter-button';
                        $('#age-group-choices').multiselect(desktopageGroupsMultiselectConfig);

                        // Mobile multiselect
                        $('#m-event-choices').multiselect(eventsMultiselectConfig);
                        // Desktop multiselect
                        var desktopEventsMultiselectConfig = eventsMultiselectConfig;
                        desktopEventsMultiselectConfig.buttonClass = 'btn btn-link filter-button';
                        $('#event-choices').multiselect(desktopEventsMultiselectConfig);
                    },

                    injectDataMultiSelect: function() {
                        var self = this;
                        // Sets the options for the multiselect
                        var country_options = [];
                        self.country_options.forEach(c => country_options.push({label: c, value: c}));
                        if (country_options.length == 0) country_options.push({label: 'No filters', value: ''});

                        $('#location-choices').multiselect('dataprovider', country_options);
                        $('#m-location-choices').multiselect('dataprovider', country_options);
                        
                        var wa_category_options = [];
                        self.waCategories.forEach(c => wa_category_options.push({label: c.code, value: c.value, title: c.label}));
                        $('#wa-category-choices').multiselect('dataprovider', wa_category_options);
                        $('#m-wa-category-choices').multiselect('dataprovider', wa_category_options);

                        var comp_series_options = self.compSeries;
                        if (comp_series_options.length == 0) comp_series_options.push({label: 'No filters', value: ''});
                        $('#series-choices').multiselect('dataprovider', comp_series_options);
                        $('#m-series-choices').multiselect('dataprovider', comp_series_options);

                        var type_options = [];
                        self.compTypes.forEach(t => type_options.push({label: t.label, value: t.value}));
                        $('#discipline-choices').multiselect('dataprovider', type_options);
                        $('#m-discipline-choices').multiselect('dataprovider', type_options);

                        var age_group_options = [];
                        self.ageGroups.forEach(ag => age_group_options.push({label: ag.label, value: ag.value}));
                        $('#age-group-choices').multiselect('dataprovider', age_group_options);
                        $('#m-age-group-choices').multiselect('dataprovider', age_group_options);

                        var event_options = [];
                        self.events.forEach(e => event_options.push({label: e.label, value: e.value, title: e.title}));
                        $('#event-choices').multiselect('dataprovider', event_options);
                        $('#m-event-choices').multiselect('dataprovider', event_options);

                    },

                    setFilterOptions: function() {
                        var self = this;

                        // Country filter options
                        self.country_options = self.info.map(item => item.country_ioc
                                                ).filter((value, index, list) => list.indexOf(value) === index).sort();

                        // Series filter options
                        var options = [];
                        self.info.forEach(data => {
                            if (data.series) {
                                var result = data.series.map(item => {
                                    return {label: item.series_name, value: item.series_id, title: item.series_name};
                                });
                                options = options.concat(result)
                            }
                        });
                        options = options.filter((value, index, list) => list.findIndex(series => (series.value == value.value)) === index);
                        // Sorting the array againest an already sorted version
                        var sortedSeries = ['EA Events', 'WACT Eur. Spe', 'WACT Eur. Silver', 'WACT Eur. Bronze', 'WAS', 'National Senior Championships', 'International Matches']
                        var options = _.sortBy(options, function(item){
                            return sortedSeries.indexOf(item.label)
                        });
                        self.series_options = options;
                    },

                    // Pagination methods
                    setPg: function (p) {
                        this.page = p
                    },
                    mvPg: function (i) {
                        this.page += i
                    },
                    maxPages: function () {
                        var self = this,
                            total = self.filteredCompetitions.length;
                        return Math.max(1, Math.ceil(total / self.showOnPage))
                    },
                    pageStartIdx: function () {
                        var self = this,
                            maxPages = self.maxPages();
                        if (self.page > maxPages)
                            self.page = maxPages;
                        return (self.page-1) * self.showOnPage + 1;
                    },
                    pageEndIdx: function () {
                        var self = this;
                        return Math.min(self.pageStartIdx() + self.showOnPage - 1, self.filteredCompetitions.length)
                    },
                    paginatedCompetitions: function () {
                        var self = this,
                            start = self.pageStartIdx() - 1;
                        return self.filteredCompetitions.slice(start, start + self.showOnPage)
                    },


                    fetchData: function() {
                        var self = this;
                        self.isLoading = true;
                        axios
                        .get(`https://file.opentrack.run/live/euroath/european_calendar_${self.selectedYear}.json`)
                        .then(response => {
                            self.info = response.data;
                            console.log(self.info);


                            self.setFilterOptions();

                            self.isLoading = false; 

                            if (!self.hasInitialised) {
                                self.initMap();   
                                self.initialiseMultiSelect();
                                self.hasInitialised = true;
                            }

                            self.injectDataMultiSelect();
                                               
                        })
                        .catch(error => {
                            console.log(error.response);
                            if (error.response.status == 404) {
                                // alert("No data found for this year!");
                                $('#errorModelTitle').text(`Competition Data Error!`)
                                $('#errorModelDescription').text(`No data found for year ${self.selectedYear}!`)
                                $('#errorModel').modal('show')
                            }
                            else if (error.response.status >= 500 && error.response.status < 600) {
                                // alert("Access denied to competition data!");
                                $('#errorModelTitle').text(`Data Access Error!`)
                                $('#errorModelDescription').text(`Unable to access competition data for year ${self.selectedYear}!`)
                                $('#errorModel').modal('show')
                            }
                            else if (error.request) {
                                // alert("Error making request for competition data!");
                                $('#errorModelTitle').text(`Data Request Error!`)
                                $('#errorModelDescription').text(`Request for data unresponsive, API server down?`)
                                $('#errorModel').modal('show')
                            }
                            self.isLoading = false; 
                        })
                    }
                },
                watch: {
                    page: function() {
                        var self = this;
                        setTimeout(function(){ self.insertMonthInTable(); }, 50);
                    },
                    filteredCompetitions: function() {
                        var self = this;
                        setTimeout(function(){ self.insertMonthInTable(); }, 50);
                    }
                },
                mounted() {
                    var self = this;
                    self.fetchData();
                }
            })
        </script>
    </body>
</html>
